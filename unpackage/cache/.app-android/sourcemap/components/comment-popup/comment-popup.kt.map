{"version":3,"sources":["components/comment-popup/comment-popup.uvue","common/socket.uts","components/article-list-item/article-list-item.uvue"],"sourcesContent":["<template>\n\t<view class=\"comment-popup-mask\" v-if=\"comment_popup_show\" @click=\"toggleCommentPopup(false,null,null)\"></view>\r\n\t<view class=\"comment-popup\" :class=\"comment_popup_show ? 'comment-popup-show' : ''\">\r\n\t\t<textarea :focus=\"focus\" class=\"comment-textarea\" :auto-height=\"true\" v-model=\"comment_data\" :placeholder=\"placeholder\"></textarea>\r\n\t\t<main-btn width=\"100rpx\" height=\"60rpx\" font-size=\"14px\" :disabled=\"comment_data == ''\" @click=\"sendComment\" style=\"margin-left: 10rpx;margin-bottom: 10rpx;\">发送</main-btn>\r\n\t</view>\n</template>\n\n<script>\r\n\timport { Result,CommentItem } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { getToken } from \"@/store/user.uts\"\n\texport default {\n\t\tname:\"comment-popup\",\r\n\t\tprops: {\r\n\t\t\tarticle_id: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0\r\n\t\t\t},\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\tcomment_popup_show:false,\n\t\t\t\tfocus:false,\r\n\t\t\t\tcomment_data:\"\",\r\n\t\t\t\tplaceholder:\"说点什么...\",\r\n\t\t\t\treply_id: null  as number | null\n\t\t\t};\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 显示/隐藏评论框\r\n\t\t\ttoggleCommentPopup(show:boolean, placeholder:string | null, reply_id : number | null){\r\n\t\t\t\tthis.comment_popup_show = show\r\n\t\t\t\tthis.placeholder = placeholder == null ? \"说点什么...\" : placeholder\r\n\t\t\t\tthis.reply_id = reply_id\r\n\t\t\t\tthis.focus = show\r\n\t\t\t},\r\n\t\t\t// 发布/回复评论\r\n\t\t\tsendComment() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '发布中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// 是否是回复\r\n\t\t\t\tlet isreply = this.reply_id == null ? false : true\r\n\t\t\t\tlet url = \"/comment/save\"\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\t\"content\": this.comment_data\r\n\t\t\t\t} as UTSJSONObject\r\n\t\t\t\t\r\n\t\t\t\t// 回复\r\n\t\t\t\tif(isreply){\r\n\t\t\t\t\turl = \"/comment/reply\"\r\n\t\t\t\t\tdata.set(\"reply_id\",this.reply_id)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.set(\"article_id\",this.article_id)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.request<Result<CommentItem>>({\r\n\t\t\t\t\turl: getURL(url),\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 全局通知：评论列表更新，首页/详情页评论数+1\r\n\t\t\t\t\t\tuni.$emit(\"onSendCommentSuccess\",r.data)\r\n\t\t\t\t\t\t// 关闭评论框\r\n\t\t\t\t\t\tthis.toggleCommentPopup(false,null,null)\r\n\t\t\t\t\t\t// 清空评论框\r\n\t\t\t\t\t\tthis.comment_data = \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\n\t}\n</script>\n\n<style>\n.comment-popup-mask {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tz-index: 101;\r\n}\r\n.comment-popup {\r\n\tz-index: 1000;\r\n\tbackground-color: #ffffff;\r\n\tposition: fixed;\r\n\tbottom: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tborder-top: 1rpx solid #f2f2f2;\r\n\tmin-height: 83rpx;\r\n\tpadding-left: 28rpx;\r\n\tpadding-right: 28rpx;\r\n\tflex-direction: row;\r\n\talign-items: flex-end;\r\n\tpadding-bottom: 20rpx;\r\n\ttransform: translateY(500rpx);\r\n\ttransition-property: transform;\r\n\ttransition-duration: 300ms;\r\n}\r\n.comment-popup-show {\r\n\ttransform: translateY(0);\r\n}\r\n.comment-textarea {\r\n\twidth: 590rpx;\r\n\tbackground-color: #f4f4f4;\r\n\tborder-radius: 5px;\r\n\tpadding: 16rpx 20rpx;\r\n\tmargin-top: 20rpx;\r\n\tmax-height: 500rpx;\r\n}\n</style>",null,null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BAqFO;;;+BALG;;;;;;;;;;uBA/E8B,KAAA,kBAAkB;gBAAzD,mBAA+G,QAAA,qBAAzG,WAAM,sBAAgD,aAAK,KAAA;oBAAE,KAAA,kBAAkB,CAAA,KAAA,EAAA,IAAA,EAAA,IAAA;gBAAA;;;;;;;YACrF,mBAGO,QAAA,SAHD,WAAK,eAAA;gBAAC;gBAAwB,IAAA,KAAA,kBAAkB;oBAAA;;oBAAA;;aAAA;gBACrD,mBAAmI,YAAA,SAAxH,WAAO,KAAA,KAAK,EAAE,WAAM,oBAAoB,iBAAa,IAAI,kBAAW,KAAA,YAAY;oBAAZ,KAAA,YAAY,GAAA,SAAA,MAAA,CAAA,KAAA;gBAAA;kBAAG,iBAAa,KAAA,WAAW;;;;;;gBACtH,YAA2K,qBAAA,SAAjK,WAAM,UAAS,YAAO,SAAQ,eAAU,QAAQ,eAAU,KAAA,YAAY,IAAA,KAAS,aAAO,KAAA,WAAW,EAAE,WAAgD,eAAhD,SAAA,iBAAA,SAAA,mBAAA,8CAAiD,gBAAE,GAAA;2BAAA;wBAAF;qBAAE;;;;;;;;;;;aAkB9J;aACA;aACA;aACA;aACA,UAAmB,MAAK;;;wBAJxB,wBAAmB,KAAK,EACxB,WAAM,KAAK,EACX,kBAAa,IACb,iBAAY,WACZ,cAAU,IAAG,CAAA,EAAI,CAAE,MAAK;;;aAKzB,qBAAA,IAAmB,MAAK,OAAO,EAAE,aAAY,MAAK,CAAQ,EAAE,UAAW,MAAK,CAAQ,EAAC;YACpF,IAAI,CAAC,kBAAiB,GAAI;YAC1B,IAAI,CAAC,WAAU,GAAI,IAAA,eAAe,IAAG;gBAAI;;gBAAY;;YAAU;YAC/D,IAAI,CAAC,QAAO,GAAI;YAChB,IAAI,CAAC,KAAI,GAAI;QACd;;aAEA,cAAA,MAAc;YACb,mCACC,QAAO,UACP,OAAM,IAAG;YAIV,IAAI,UAAU,IAAA,IAAI,CAAC,QAAO,IAAK,IAAG;gBAAI,KAAI;;gBAAI,IAAG;;YAAA;YACjD,IAAI,MAAM;YACV,IAAI,sBAAO;uCAAA,qBAAA,QAAA,+CAAA,EAAA,EAAA,CAAA;oBACV,cAAW,GAAK,YAAW;;aAC5B;YAGA,IAAG,SAAQ;gBACV,MAAM;gBACN,KAAK,GAAG,CAAC,YAAW,IAAI,CAAC,QAAQ;YAClC,OAAO;gBACN,KAAK,GAAG,CAAC,cAAa,IAAI,CAAC,UAAU;YACtC;YAEA,gDACC,MAAK,OAAO,MACZ,SAAQ,QACR,SAAO;gBACN,IAAA,QAAM;aACN,EACD,OAAA,MACA,UAAS,IAAA,IAAO;gBACf,IAAI,IAAI,IAAI,IAAG;gBACf,IAAG,KAAK,IAAI;oBAAE;;gBACd,IAAG,IAAI,UAAS,IAAI,GAAG,EAAC;oBACvB,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;oBAEP;gBACD;gBAGA,UAAU,wBAAuB,EAAE,IAAI;gBAEvC,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAC,IAAI,EAAC,IAAI;gBAEvC,IAAI,CAAC,YAAW,GAAI;YACrB;cACA,OAAM,IAAC,IAAQ;gBACd,+BACC,QAAO,IAAI,MAAM,EACjB,OAAM;YAER;cACA,WAAU,MAAM;gBACf;YACD;;QAEF;;;sBA/DA,qBAAmB,MAAK,OAAO,EAAE,aAAY,MAAK,GAAU,UAAW,MAAK;sBAO5E;;mBAzBI;;;;;;;;;;;;;;6GAIM,CAAA"}