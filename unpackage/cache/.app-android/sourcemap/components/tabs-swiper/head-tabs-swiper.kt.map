{"version":3,"sources":["components/tabs-swiper/head-tabs-swiper.uvue"],"sourcesContent":["<template>\r\n\t<scroll-view ref=\"pageScrollView\" class=\"page\" :rebound=\"false\" @startnestedscroll=\"onStartNestedScroll\"\r\n\t\t@nestedprescroll=\"onNestedPreScroll\" :nested-scroll-child=\"nestedScrollChildId\">\r\n\t\t<view ref=\"header\">\r\n\t\t\t<slot name=\"header\"/>\r\n\t\t</view>\r\n\t\t<view class=\"swiper-list\">\r\n\t\t\t<scroll-view ref=\"tabScroll\" class=\"swiper-tabs\" direction=\"horizontal\" :show-scrollbar=\"false\">\r\n\t\t\t\t<view class=\"tab\" :class=\"{ 'tab-center' : tabCenter }\">\r\n\t\t\t\t\t<text ref=\"swipertab\" class=\"swiper-tabs-item\"\r\n\t\t\t\t\t\t:class=\"swiperIndex==index ? 'swiper-tabs-item-active' : ''\" v-for=\"(item, index) in tabs\"\r\n\t\t\t\t\t\t:key=\"index\" @click=\"onTabClick(index)\">\r\n\t\t\t\t\t\t{{item.name}}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view ref=\"indicator\" class=\"swiper-tabs-indicator\"></view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<swiper ref=\"swiper\" class=\"swiper-view\" :current=\"swiperIndex\" @transition=\"onSwiperTransition\"\r\n\t\t\t\t@animationfinish=\"onSwiperAnimationfinish\">\r\n\t\t\t\t<slot/>\r\n\t\t\t</swiper>\r\n\t\t</view>\r\n\t</scroll-view>\r\n</template>\r\n\r\n<script>\r\n\timport type { TabsSwiperItem } from \"./type.uts\"\r\n\r\n\ttype SwiperTabsItem = {\r\n\t\tx : number,\r\n\t\tw : number\r\n\t}\r\n\r\n\t/**\r\n\t * 根据权重在两个值之间执行线性插值.\r\n\t * @constructor\r\n\t * @param {number} value1 - 第一个值，该值应为下限.\r\n\t * @param {number} value2 - 第二个值，该值应为上限.\r\n\t * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\r\n\t * @returns {number} 内插值\r\n\t */\r\n\tfunction lerpNumber(value1 : number, value2 : number, amount : number) : number {\r\n\t\treturn (value1 + (value2 - value1) * amount)\r\n\t}\r\n\r\n\texport default {\r\n\t\temits:[\"loadData\",\"change\"],\r\n\t\tprops: {\r\n\t\t\ttabs: {\r\n\t\t\t\ttype: Array as PropType<TabsSwiperItem[]>,\r\n\t\t\t\trequired:true \r\n\t\t\t},\r\n\t\t\ttabCenter:{\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault:false\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tswiperIndex: 0,\r\n\t\t\t\tpageScrollView: null as null | UniElement,\r\n\t\t\t\theaderHeight: 0,\r\n\t\t\t\tanimationFinishIndex: 0,\r\n\t\t\t\ttabScrollView: null as null | UniElement,\r\n\t\t\t\tindicatorNode: null as null | UniElement,\r\n\t\t\t\tswiperWidth: 0,\r\n\t\t\t\tswiperTabsRect: [] as SwiperTabsItem[],\r\n\t\t\t\tnestedScrollChildId: \"\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\tthis.pageScrollView = this.$refs['pageScrollView'] as UniElement;\r\n\t\t\t\tthis.headerHeight = (this.$refs['header'] as UniElement).offsetHeight\r\n\t\t\t\tthis.swiperWidth = (this.$refs['swiper'] as UniElement).getBoundingClientRect().width\r\n\t\t\t\tthis.tabScrollView = this.$refs['tabScroll'] as UniElement\r\n\t\t\t\tthis.indicatorNode = this.$refs['indicator'] as UniElement\r\n\t\t\t\tthis.cacheTabItemsSize()\r\n\t\t\t\tthis.updateTabIndicator(this.swiperIndex, this.swiperIndex, 1)\r\n\t\t\t})\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\ttabs(_:TabsSwiperItem[]) {\r\n\t\t\t\tthis.cacheTabItemsSize()\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// TODO\r\n\t\t\tonStartNestedScroll(_ : StartNestedScrollEvent) : boolean {\r\n\t\t\t\treturn true\r\n\t\t\t},\r\n\t\t\tonNestedPreScroll(event : NestedPreScrollEvent) {\r\n\t\t\t\tconst deltaY = event.deltaY\r\n\t\t\t\tconst scrollTop = this.pageScrollView!.scrollTop\r\n\r\n\t\t\t\tif (deltaY > 0) {\r\n\t\t\t\t\t// 向上滚动，如果父容器 header scrollTop < offsetHeight，先滚动父容器\r\n\t\t\t\t\tif (scrollTop < this.headerHeight) {\r\n\t\t\t\t\t\tconst difference = this.headerHeight - scrollTop - deltaY\r\n\t\t\t\t\t\tif (difference > 0) {\r\n\t\t\t\t\t\t\tthis.pageScrollView!.scrollBy(event.deltaX, deltaY)\r\n\t\t\t\t\t\t\tevent.consumed(event.deltaX, deltaY)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst top : number = deltaY + difference\r\n\t\t\t\t\t\t\tevent.consumed(event.deltaX, top.toFloat())\r\n\t\t\t\t\t\t\tthis.pageScrollView!.scrollBy(event.deltaX, top.toFloat())\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonTabClick(index : number) {\r\n\t\t\t\tthis.setSwiperIndex(index, false)\r\n\t\t\t},\r\n\t\t\tonSwiperTransition(e : SwiperTransitionEvent) {\r\n\t\t\t\t// 微信 skyline 每项完成触发 Animationfinish，偏移值重置\r\n\t\t\t\t// 微信 webview 全部完成触发 Animationfinish，偏移值累加\r\n\t\t\t\t// 在滑动到下一个项的过程中，再次反向滑动，偏移值递减\r\n\t\t\t\t// uni-app-x 和微信 webview 行为一致\r\n\r\n\t\t\t\tconst offset_x = e.detail.dx\r\n\r\n\t\t\t\t// 计算当前索引并重置差异\r\n\t\t\t\tconst current_offset_x = offset_x % this.swiperWidth\r\n\t\t\t\tconst current_offset_i = offset_x / this.swiperWidth\r\n\t\t\t\tconst current_index = this.animationFinishIndex + parseInt(current_offset_i + '')\r\n\r\n\t\t\t\t// 计算目标索引及边界检查\r\n\t\t\t\tlet move_to_index = current_index\r\n\t\t\t\tif (current_offset_x > 0 && move_to_index < this.tabs.length - 1) {\r\n\t\t\t\t\tmove_to_index += 1\r\n\t\t\t\t} else if (current_offset_x < 0 && move_to_index > 0) {\r\n\t\t\t\t\tmove_to_index -= 1\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 计算偏移百分比\r\n\t\t\t\tconst percentage = Math.abs(current_offset_x) / this.swiperWidth\r\n\r\n\t\t\t\t// 通知更新指示线\r\n\t\t\t\tif (current_index != move_to_index) {\r\n\t\t\t\t\tthis.updateTabIndicator(current_index, move_to_index, percentage)\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 首次可见时初始化数据\r\n\t\t\t\tthis.initSwiperItemData(move_to_index)\r\n\t\t\t},\r\n\t\t\tonSwiperAnimationfinish(e : SwiperAnimationFinishEvent) {\r\n\t\t\t\tthis.setSwiperIndex(e.detail.current, true)\r\n\t\t\t\tthis.animationFinishIndex = e.detail.current\r\n\t\t\t},\r\n\t\t\tcacheTabItemsSize() {\r\n\t\t\t\tthis.swiperTabsRect.length = 0\r\n\t\t\t\tconst tabs = this.$refs[\"swipertab\"] as UniElement[]\r\n\t\t\t\ttabs.forEach((node) => {\r\n\t\t\t\t\tthis.swiperTabsRect.push({\r\n\t\t\t\t\t\tx: node.offsetLeft,\r\n\t\t\t\t\t\tw: node.offsetWidth\r\n\t\t\t\t\t} as SwiperTabsItem)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tsetSwiperIndex(index : number, updateIndicator : boolean) {\r\n\t\t\t\tif (this.swiperIndex === index) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.swiperIndex = index\r\n\t\t\t\tthis.$emit(\"change\",this.swiperIndex)\r\n\r\n\t\t\t\tthis.initSwiperItemData(index)\r\n\r\n\t\t\t\tif (updateIndicator) {\r\n\t\t\t\t\tthis.updateTabIndicator(index, index, 1)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateTabIndicator(current_index : number, move_to_index : number, percentage : number) {\r\n\t\t\t\tconst current_size = this.swiperTabsRect[current_index]\r\n\t\t\t\tconst move_to_size = this.swiperTabsRect[move_to_index]\r\n\r\n\t\t\t\t// 计算指示线 左边距 和 宽度 在移动过程中的线性值\r\n\t\t\t\tconst indicator_line_x = lerpNumber(current_size.x, move_to_size.x, percentage)\r\n\t\t\t\tconst indicator_line_w = lerpNumber(current_size.w, move_to_size.w, percentage)\r\n\r\n\t\t\t\t// 更新指示线\r\n\r\n\t\t\t\tconst x = indicator_line_x + indicator_line_w / 2\r\n\t\t\t\tthis.indicatorNode?.style?.setProperty('transform', `translateX(${x}px) scaleX(${indicator_line_w})`)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t// 滚动到水平中心位置\r\n\t\t\t\tconst scroll_x = x - this.swiperWidth / 2\r\n\t\t\t\tif (this.tabScrollView !== null) {\r\n\t\t\t\t\tthis.tabScrollView!.scrollLeft = scroll_x\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinitSwiperItemData(index : number) {\r\n\t\t\t\tif (!this.tabs[index].preload) {\r\n\t\t\t\t\tthis.tabs[index].preload = true;\r\n\t\t\t\t\tthis.$emit(\"loadData\",index as number)\r\n\t\t\t\t}\r\n\t\t\t\t//swiper页面切换需要重新赋值嵌套滚动子元素的id\r\n\t\t\t\tthis.nestedScrollChildId = 'list_'+this.tabs[index].id\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.flex-row {\r\n\t\tflex-direction: row;\r\n\t}\r\n\r\n\t.page {\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.search-bar {\r\n\t\tpadding: 10px;\r\n\t}\r\n\r\n\t.swiper-list {\r\n\t\theight: 100%;\r\n\r\n\r\n\r\n\t}\r\n\r\n\t.swiper-tabs {\r\n\t\tbackground-color: #ffffff;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.swiper-tabs-item {\r\n\t\tcolor: #555;\r\n\t\tfont-size: 16px;\r\n\t\tpadding: 12px 25px;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\r\n\t.swiper-tabs-item-active {\r\n\t\tcolor: #F06487;\r\n\t}\r\n\r\n\t.swiper-tabs-indicator {\r\n\t\twidth: 1px;\r\n\t\theight: 2px;\r\n\t\tbackground-color: #F06487;\r\n\t}\r\n\r\n\t.swiper-view {\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.swiper-item {\r\n\t\tflex: 1;\r\n\t}\r\n\t\r\n\t.tab {\r\n\t\tflex-direction: row; \r\n\t\talign-self: flex-start;\r\n\t}\r\n\t\r\n\t.tab-center {\r\n\t\twidth: 750rpx;\r\n\t\tjustify-content: center;\r\n\t}\r\n</style>"],"names":[],"mappings":"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"}