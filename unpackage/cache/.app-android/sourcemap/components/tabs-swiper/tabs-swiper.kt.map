{"version":3,"sources":["components/tabs-swiper/tabs-swiper.uvue","store/user.uts"],"sourcesContent":["<template>\r\n\t<slot name=\"navbar\">\r\n\t\t<status-bar/>\r\n\t</slot>\r\n\t<view class=\"flex-1\">\r\n\t\t<view class=\"flex\">\r\n\t\t\t<scroll-view ref=\"tabScroll\" class=\"swiper-tabs\" direction=\"horizontal\" :show-scrollbar=\"false\" :style=\"showSearchIcon ? 'width: 646rpx;' : 'width: 750rpx;'\">\r\n\t\t\t\t<view class=\"swiper-tabs-item\">\r\n\t\t\t\t\t<text ref=\"swipertab\" class=\"swiper-tabs-item-text\"\r\n\t\t\t\t\t\t:class=\"swiperIndex==index ? 'swiper-tabs-item-active' : ''\" v-for=\"(item, index) in tabs\"\r\n\t\t\t\t\t\t:key=\"index\" @click=\"onTabClick(index)\">\r\n\t\t\t\t\t\t{{item.name}}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<view class=\"search\" v-if=\"showSearchIcon\" @click=\"openSearch\">\r\n\t\t\t\t<text class=\"iconfont\">{{'\\ue606'}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<swiper ref=\"swiper\" class=\"flex-1\" :current=\"swiperIndex\" @transition=\"onSwiperTransition\" @animationfinish=\"onSwiperAnimationfinish\">\r\n\t\t\t<slot />\r\n\t\t</swiper>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport type { TabsSwiperItem } from \"./type.uts\"\r\n\timport type { PropType } from \"vue\"\r\n\r\n\t/**\r\n\t * 根据权重在两个值之间执行线性插值.\r\n\t * @constructor\r\n\t * @param {number} value1 - 第一个值，该值应为下限.\r\n\t * @param {number} value2 - 第二个值，该值应为上限.\r\n\t * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\r\n\t * @returns {number} 内插值\r\n\t */\r\n\tfunction lerpNumber(value1 : number, value2 : number, amount : number) : number {\r\n\t\treturn (value1 + (value2 - value1) * amount)\r\n\t}\r\n\r\n\texport default {\r\n\t\temits:[\"loadData\",\"change\"],\r\n\t\tprops: {\r\n\t\t\ttabs: {\r\n\t\t\t\ttype: Array as PropType<TabsSwiperItem[]>,\r\n\t\t\t\trequired:true \r\n\t\t\t},\r\n\t\t\tshowSearchIcon:{\r\n\t\t\t\ttype:Boolean,\r\n\t\t\t\tdefault:false\r\n\t\t\t},\r\n\t\t\tdefaultTabIndex:{\r\n\t\t\t\ttype:Number,\r\n\t\t\t\tdefault:0\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tswiperIndex: 0,\r\n\t\t\t\ttabScrollView: null as null | UniElement,\r\n\t\t\t\tanimationFinishIndex: 0,\r\n\t\t\t\tswiperWidth: 0\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.swiperIndex = this.defaultTabIndex\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\tthis.tabScrollView = this.$refs['tabScroll'] as UniElement\r\n\t\t\t\tthis.swiperWidth = (this.$refs[\"swiper\"] as UniElement).getBoundingClientRect().width\r\n\t\t\t\t// this.updateTabIndicator(this.swiperIndex, this.swiperIndex, 1)\r\n\t\t\t})\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\topenSearch(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/search/search',\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonTabClick(index : number) {\r\n\t\t\t\tthis.setSwiperIndex(index, false)\r\n\t\t\t},\r\n\t\t\tonSwiperTransition(e : SwiperTransitionEvent) {\r\n\t\t\t\tconst offset_x = e.detail.dx\r\n\r\n\t\t\t\t// 计算当前索引并重置差异\r\n\t\t\t\tconst current_offset_x = offset_x % this.swiperWidth\r\n\t\t\t\tconst current_offset_i = offset_x / this.swiperWidth\r\n\t\t\t\tconst current_index = this.animationFinishIndex + parseInt(current_offset_i + '')\r\n\r\n\t\t\t\t// 计算目标索引及边界检查\r\n\t\t\t\tlet move_to_index = current_index\r\n\t\t\t\tif (current_offset_x > 0 && move_to_index < this.tabs.length - 1) {\r\n\t\t\t\t\tmove_to_index += 1\r\n\t\t\t\t} else if (current_offset_x < 0 && move_to_index > 0) {\r\n\t\t\t\t\tmove_to_index -= 1\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 计算偏移百分比\r\n\t\t\t\tconst percentage = Math.abs(current_offset_x) / this.swiperWidth\r\n\r\n\t\t\t\t// 通知更新指示线\r\n\t\t\t\tif (current_index != move_to_index) {\r\n\t\t\t\t\tthis.updateTabIndicator(current_index, move_to_index, percentage)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 首次可见时初始化数据\r\n\t\t\t\tthis.initSwiperItemData(move_to_index)\r\n\t\t\t},\r\n\t\t\tonSwiperAnimationfinish(e : SwiperAnimationFinishEvent) {\r\n\t\t\t\tthis.setSwiperIndex(e.detail.current, true)\r\n\t\t\t\tthis.animationFinishIndex = e.detail.current\r\n\t\t\t},\r\n\t\t\tsetSwiperIndex(index : number, updateIndicator : boolean) {\r\n\t\t\t\tif (this.swiperIndex == index) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.swiperIndex = index\r\n\t\t\t\tthis.$emit(\"change\",this.swiperIndex)\r\n\t\t\t\t\r\n\t\t\t\tthis.initSwiperItemData(index)\r\n\r\n\t\t\t\tif (updateIndicator) {\r\n\t\t\t\t\tthis.updateTabIndicator(index, index, 1)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateTabIndicator(current_index : number, move_to_index : number, percentage : number) {\r\n\t\t\t\tif (percentage == 0) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 缩放范围\r\n\t\t\t\tconst min_ratio = 1\r\n\t\t\t\tconst max_ratio = 1.3\r\n\r\n\t\t\t\tconst tabs = this.$refs['swipertab'] as UniElement[]\r\n\t\t\t\tconst current_node = tabs[current_index]\r\n\t\t\t\tconst move_to_node = tabs[move_to_index]\r\n\r\n\t\t\t\t// 当前\r\n\t\t\t\tconst current_scale = lerpNumber(min_ratio, max_ratio, 1 - percentage)\r\n\t\t\t\tcurrent_node.style.setProperty('transform', `scale(${current_scale})`)\r\n\r\n\t\t\t\t// 目标\r\n\t\t\t\tconst move_to_scale = lerpNumber(min_ratio, max_ratio, percentage)\r\n\t\t\t\tmove_to_node.style.setProperty('transform', `scale(${move_to_scale})`)\r\n\r\n\t\t\t\t// 滚动到水平中心位置\r\n\t\t\t\tconst target_x = lerpNumber(current_node.offsetLeft, move_to_node.offsetLeft, percentage)\r\n\t\t\t\tconst center_x = target_x + move_to_node.offsetWidth / 2 - this.swiperWidth / 2\r\n\t\t\t\tthis.tabScrollView!.scrollLeft = center_x\r\n\t\t\t},\r\n\t\t\tinitSwiperItemData(index : number) {\r\n\t\t\t\tif (!this.tabs[index].preload) {\r\n\t\t\t\t\tthis.tabs[index].preload = true;\r\n\t\t\t\t\tthis.$emit(\"loadData\",index as number)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.flex {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t\r\n\t.flex-1{\r\n\t\tflex:1;\r\n\t}\r\n\t\r\n\t.search {\r\n\t\theight: 103rpx;\r\n\t\twidth: 103rpx;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.swiper-tabs {\r\n\t\theight: 103rpx;\r\n\t}\r\n\t\r\n\t.swiper-tabs-item {\r\n\t\tflex-direction: row;\r\n\t\talign-self: flex-start;\r\n\t\theight: 103rpx;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.swiper-tabs-item-text {\r\n\t\tcolor: #555;\r\n\t\tfont-size: 16px;\r\n\t\tfont-weight: bold;\r\n\t\tmargin: 0 20rpx;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\r\n\t.swiper-tabs-item-active {\r\n\t\tcolor: #F06487;\r\n\t}\r\n\r\n</style>",null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BA+JW;;;kBA7FT,MAAU;YACT,IAAI,CAAC,WAAU,GAAI,IAAI,CAAC,eAAc;QACvC;;kBACA,MAAU;YACT,IAAI,CAAC,WAAS,CAAC,KAAI;gBAClB,IAAI,CAAC,aAAY,GAAI,IAAI,CAAC,OAAK,CAAC,YAAW,CAAE,EAAC,CAAE;gBAChD,IAAI,CAAC,WAAU,GAAI,CAAC,IAAI,CAAC,OAAK,CAAC,SAAQ,CAAE,EAAC,CAAE,UAAU,EAAE,qBAAqB,GAAG,KAAI;YAErF;;QACD;;;;;;;;;YA1ED,WAEO,KAAA,QAAA,EAAA,UAAA,eAAA,EAFP,gBAEO,GAAA;uBAAA;oBADN,YAAa;;;;YAEd,mBAmBO,QAAA,SAnBD,WAAM,WAAQ;gBACnB,mBAaO,QAAA,SAbD,WAAM,SAAM;oBACjB,mBAQc,eAAA,SARD,SAAI,aAAY,WAAM,eAAc,eAAU,cAAc,oBAAgB,KAAK,EAAG,WAAK,eAAE,IAAA,KAAA,cAAc;wBAAA;;wBAAA;;oBAAA;wBACrH,mBAMO,QAAA,SAND,WAAM,qBAAkB;4BAC7B,mBAIO,UAAA,IAAA,EAAA,cAAA,UAAA,CAH+E,KAAA,IAAI,EAAA,IAApB,MAAM,OAAN,GAAI,IAAA,MAAA;uCAD1E,mBAIO,QAAA,4BAJD,SAAI,aAAY,WAAK,eAAA;oCAAC;oCACnB,IAAA,KAAA,WAAW,IAAE;wCAAK;;wCAAA;;iCAAA,GACzB,SAAK,OAAQ,aAAK,KAAA;oCAAE,KAAA,UAAU,CAAC;gCAAK;mDACnC,KAAK,IAAI,GAAA,EAAA,EAAA;oCAAA;iCAAA;;;;;+BAIa,KAAA,cAAc;wBAAzC,mBAEO,QAAA,qBAFD,WAAM,UAAgC,aAAO,KAAA,UAAU;4BAC5D,mBAA0C,QAAA,SAApC,WAAM,aAAU,gBAAG;;;;;;;;gBAI3B,mBAES,UAAA,SAFD,SAAI,UAAS,WAAM,UAAU,aAAS,KAAA,WAAW,EAAG,kBAAY,KAAA,kBAAkB,EAAG,uBAAiB,KAAA,uBAAuB;oBACpI,WAAQ,KAAA,QAAA,EAAA;;;;;;;;;;;;aAuCP;aACA,eAA8B;aAC9B;aACA;;;wBAHA,iBAAa,CAAC,EACd,mBAAe,IAAG,CAAE,EAAC,CAAS,aAC9B,0BAAsB,CAAC,EACvB,iBAAa,CAAA;;;aAcd,aAAA,MAAY;YACX,iCACC,MAAK;QAEP;;aACA,aAAA,IAAW,OAAQ,MAAM,EAAE;YAC1B,IAAI,CAAC,cAAc,CAAC,OAAO,KAAK;QACjC;;aACA,qBAAA,IAAmB,GAAI,qBAAqB,EAAE;YAC7C,IAAM,WAAW,EAAE,MAAM,CAAC,EAAC;YAG3B,IAAM,mBAAmB,WAAW,IAAI,CAAC,WAAU;YACnD,IAAM,mBAAmB,WAAW,IAAI,CAAC,WAAU;YACnD,IAAM,gBAAgB,IAAI,CAAC,oBAAmB,GAAI,SAAS,mBAAmB;YAG9E,IAAI,gBAAgB;YACpB,IAAI,mBAAmB,CAAA,IAAK,gBAAgB,IAAI,CAAC,IAAI,CAAC,MAAK,GAAI,CAAC,EAAE;gBACjE,iBAAiB,CAAA;YAClB,OAAO,IAAI,mBAAmB,CAAA,IAAK,gBAAgB,CAAC,EAAE;gBACrD,iBAAiB,CAAA;YAClB;YAGA,IAAM,aAAa,KAAK,GAAG,CAAC,oBAAoB,IAAI,CAAC,WAAU;YAG/D,IAAI,iBAAiB,eAAe;gBACnC,IAAI,CAAC,kBAAkB,CAAC,eAAe,eAAe;YACvD;YAGA,IAAI,CAAC,kBAAkB,CAAC;QACzB;;aACA,0BAAA,IAAwB,GAAI,0BAA0B,EAAE;YACvD,IAAI,CAAC,cAAc,CAAC,EAAE,MAAM,CAAC,OAAO,EAAE,IAAI;YAC1C,IAAI,CAAC,oBAAmB,GAAI,EAAE,MAAM,CAAC,OAAM;QAC5C;;aACA,iBAAA,IAAe,OAAQ,MAAM,EAAE,iBAAkB,OAAO,EAAE;YACzD,IAAI,IAAI,CAAC,WAAU,IAAK,OAAO;gBAC9B;YACD;YAEA,IAAI,CAAC,WAAU,GAAI;YACnB,IAAI,CAAC,OAAK,CAAC,UAAS,IAAI,CAAC,WAAW;YAEpC,IAAI,CAAC,kBAAkB,CAAC;YAExB,IAAI,iBAAiB;gBACpB,IAAI,CAAC,kBAAkB,CAAC,OAAO,OAAO,CAAC;YACxC;QACD;;aACA,qBAAA,IAAmB,eAAgB,MAAM,EAAE,eAAgB,MAAM,EAAE,YAAa,MAAM,EAAE;YACvF,IAAI,cAAc,CAAC,EAAE;gBACpB;YACD;YAGA,IAAM,oBAAY,CAAA;YAClB,IAAM,oBAAY,GAAE;YAEpB,IAAM,OAAO,IAAI,CAAC,OAAK,CAAC,YAAW,CAAE,EAAC,UAAE;YACxC,IAAM,eAAe,IAAI,CAAC,cAAa;YACvC,IAAM,eAAe,IAAI,CAAC,cAAa;YAGvC,IAAM,gBAAgB,WAAW,WAAW,WAAW,CAAA,GAAI;YAC3D,aAAa,KAAK,CAAC,WAAW,CAAC,aAAa,AAAC,WAAQ,gBAAc;YAGnE,IAAM,gBAAgB,WAAW,WAAW,WAAW;YACvD,aAAa,KAAK,CAAC,WAAW,CAAC,aAAa,AAAC,WAAQ,gBAAc;YAGnE,IAAM,WAAW,WAAW,aAAa,UAAU,EAAE,aAAa,UAAU,EAAE;YAC9E,IAAM,WAAW,WAAW,aAAa,WAAU,GAAI,CAAA,GAAI,IAAI,CAAC,WAAU,GAAI,CAAA;YAC9E,IAAI,CAAC,aAAa,GAAE,UAAS,GAAI;QAClC;;aACA,qBAAA,IAAmB,OAAQ,MAAM,EAAE;YAClC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;gBAC9B,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAM,GAAI,IAAI;gBAC/B,IAAI,CAAC,OAAK,CAAC,YAAW,MAAM,EAAC,CAAE,MAAM;YACtC;QACD;;;sBApFA;sBAKA,aAAW,OAAQ,MAAM;sBAGzB,qBAAmB,GAAI;sBA2BvB,0BAAwB,GAAI;sBAI5B,iBAAe,OAAQ,MAAM,EAAE,iBAAkB,OAAO;sBAcxD,qBAAmB,eAAgB,MAAM,EAAE,eAAgB,MAAM,EAAE,YAAa,MAAM;sBA0BtF,qBAAmB,OAAQ,MAAM;;;;;;;;;;;;;;;uGA7GvB,IAAG,kEAIJ,KAAI,kEAIJ,CAAA"}