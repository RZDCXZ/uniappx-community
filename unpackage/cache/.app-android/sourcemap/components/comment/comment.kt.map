{"version":3,"sources":["components/comment/comment.uvue","pages/long-list/long-list-page.uvue","store/user.uts","common/socket.uts"],"sourcesContent":["<template>\r\n\t<view class=\"comment-section\">\r\n\t\t<text class=\"comment-title\">{{ isreply ? `${support_count} 条回复` : '评论' }}</text>\r\n\t\t<text class=\"comment-count\" v-if=\"!isreply\">{{ support_count }}人表态</text>\r\n\t</view>\r\n\t<tip v-if=\"commentList.length == 0 && !isFirstLoad\" title=\"暂无评论~\"></tip>\r\n\t<view class=\"comment\" v-for=\"(ct,ctI) in commentList\" :key=\"ctI\">\r\n\t\t<view class=\"flex\">\r\n\t\t\t<avatar :src=\"ct.avatar\" style=\"margin-right: 27rpx;\" @click=\"openUserSpace(ct.user_id)\"></avatar>\r\n\t\t\t<text class=\"comment-nickname\" @click=\"openUserSpace(ct.user_id)\">{{ ct.name }}</text>\r\n\t\t\t<text class=\"comment-time\">{{ ct.create_time }}</text>\r\n\t\t</view>\r\n\t\t<text class=\"comment-content\">{{ ct.content }}</text>\r\n\t\t\r\n\t\t<!-- 渲染@用户引用评论 -->\r\n\t\t<rich-text class=\"comment-quote\" v-if=\"ct.quote != null\" :nodes=\"`<a href='/pages/user-space/user-space?user_id=${ct.quote?.user_id}'>${ct.quote?.name}</a>：<span>${ct.quote?.content}</span>`\" @itemclick=\"handleRichItemClick\"></rich-text>\r\n\t\t\r\n\t\t<!-- 回复数>0 -->\r\n\t\t<view class=\"reply\" hover-class=\"reply-hover\" v-if=\"ct.reply_count > 0\" @click=\"openCommentDetail(ct.id)\">\r\n\t\t\t<text class=\"reply-text\">{{ ct.reply_count }}条回复</text>\r\n\t\t\t<text class=\"iconfont reply-icon\">{{ '\\ue60c' }}</text>\r\n\t\t</view>\r\n\t\t<!-- 回复数=0 -->\r\n\t\t<view class=\"reply\" :style=\"isreply ? 'background:#ffffff;' : ''\" hover-class=\"reply-hover\" v-else @click=\"handleReply(ct.name,ct.id)\">\r\n\t\t\t<text class=\"reply-text\">回复</text>\r\n\t\t</view>\r\n\t</view>\r\n\t\r\n\t<loading-more v-if=\"isFirstLoad || commentList.length > 0\" :loading=\"loading\" :isEnded=\"isEnded\"></loading-more>\r\n</template>\r\n\r\n<script>\r\n\timport { CommentItem,CommentItemResult,Result,ReplyEmit } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\texport default {\r\n\t\temits:[\"reply\"],\r\n\t\tname: \"comment\",\r\n\t\tprops: {\r\n\t\t\tsupport_count: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0\r\n\t\t\t},\r\n\t\t\tarticle_id:{\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0\r\n\t\t\t},\r\n\t\t\t// 是否在回复页\r\n\t\t\tisreply:{\r\n\t\t\t\ttype:Boolean,\r\n\t\t\t\tdefault:false\r\n\t\t\t},\r\n\t\t\t// 父级评论ID\r\n\t\t\tcomment_id:{\r\n\t\t\t\ttype:Number,\r\n\t\t\t\tdefault:0\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.loadCommentList()\r\n\t\t\tuni.$on(\"onSendCommentSuccess\",this.onSendCommentSuccess)\r\n\t\t},\r\n\t\tunmounted() {\r\n\t\t\tuni.$off(\"onSendCommentSuccess\",this.onSendCommentSuccess)\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcommentList: [] as CommentItem[],\r\n\t\t\t\tisEnded:false,\r\n\t\t\t\tcurrentPage:1,\r\n\t\t\t\tloading:false,\r\n\t\t\t\tisFirstLoad:true\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\thandleRichItemClick(e:UniRichTextItemClickEvent){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: e.detail.href as string\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 回复\r\n\t\t\thandleReply(name:string | null,reply_id:number){\r\n\t\t\t\tconst placeholder = \"回复@\"+name\r\n\t\t\t\tthis.$emit(\"reply\",{\r\n\t\t\t\t\tplaceholder,\r\n\t\t\t\t\treply_id\r\n\t\t\t\t} as ReplyEmit)\r\n\t\t\t},\r\n\t\t\t// 回复/评论成功回调\r\n\t\t\tonSendCommentSuccess(e:CommentItem){\r\n\t\t\t\t// 回复\r\n\t\t\t\tif(!this.isreply && e.comment_id != null){\r\n\t\t\t\t\tlet i = this.commentList.findIndex((o:CommentItem):boolean => o.id == e.comment_id)\r\n\t\t\t\t\tif(i == -1) return\r\n\t\t\t\t\t// 回复数+1\r\n\t\t\t\t\tthis.commentList[i].reply_count = Math.floor(this.commentList[i].reply_count + 1)\r\n\t\t\t\t} \r\n\t\t\t\t// 评论\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.commentList = [ e,...this.commentList ]\r\n\t\t\t\t}\t\r\n\t\t\t},\r\n\t\t\topenUserSpace(user_id:number){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/user-space/user-space?user_id='+user_id,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topenCommentDetail(id:number){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/comment-detail/comment-detail?id='+id,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tloadCommentList(){\r\n\t\t\t\tif(this.loading || this.isEnded){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tconst page = Math.floor(this.currentPage)\r\n\t\t\t\tlet url = `/article/${this.article_id}/comment/${page}`\r\n\t\t\t\t\r\n\t\t\t\t// 回复列表\r\n\t\t\t\tif(this.isreply){\r\n\t\t\t\t\turl = `/comment/${this.comment_id}/replies/${page}`\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.request<Result<CommentItemResult>>({\r\n\t\t\t\t\turl:getURL(url),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst resData = r.data as CommentItemResult | null\r\n\t\t\t\t\t\tif(resData == null) return\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 是否还有数据\r\n\t\t\t\t\t\tthis.isEnded = resData.last_page <= resData.current_page\r\n\t\t\t\t\t\tif(this.currentPage == 1){\r\n\t\t\t\t\t\t\tthis.commentList = resData.data\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.commentList.push(...resData.data)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 页码+1\r\n\t\t\t\t\t\tthis.currentPage = this.isEnded ? resData.current_page : Math.floor(resData.current_page + 1)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t\tthis.isFirstLoad = false\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n.comment-section {\r\n\tflex-direction: row;\r\n\theight: 80rpx;\r\n\twidth: 750rpx;\r\n\talign-items: center;\r\n\tpadding: 0 32rpx;\r\n\tjustify-content: space-between;\r\n}\r\n.comment-title {\r\n\tfont-size: 16px;\r\n\tfont-weight: bold;\r\n}\r\n.comment-count {\r\n\tfont-size: 13px;\r\n\tcolor: #8b8b8b;\r\n}\r\n.comment {\r\n\tpadding: 20rpx 30rpx;\r\n}\r\n.comment-nickname {\r\n\tmax-width: 224rpx;\r\n\ttext-overflow: ellipsis;\r\n\theight: 30rpx;\r\n\tfont-size: 14px;\r\n\tmargin-top: 15rpx;\r\n\tline-height: 1.2;\r\n\tmargin-right: 10rpx;\r\n}\r\n.comment-time {\r\n\tfont-size: 13px;\r\n\tcolor: #a7a7a7;\r\n\tmargin-top: 15rpx;\r\n\tmargin-left: auto;\r\n\tline-height: 1.2;\r\n}\r\n.comment-content {\r\n\tfont-size: 16px;\r\n\twidth: 590rpx;\r\n\tmargin-left: 98rpx;\r\n\tline-height: 1.5;\r\n\tmargin-top: 10rpx;\r\n}\r\n.reply {\r\n\tbackground-color: #f8f8f8;\r\n\tborder-radius: 50px;\r\n\tpadding: 10rpx 18rpx;\r\n\talign-self: flex-start;\r\n\tmargin-left: 98rpx;\r\n\tmargin-top: 20rpx;\r\n\tflex-direction: row;\r\n}\r\n.reply-hover {\r\n\tbackground-color: #f2f2f2;\r\n}\r\n.reply-text {\r\n\tcolor: #0a0a0a;\r\n\tfont-size: 12px;\r\n}\r\n.reply-icon {\r\n\tcolor: #0a0a0a;\r\n\tfont-size: 12px;\r\n\tmargin-left: 5rpx;\r\n}\r\n.comment-quote {\r\n\twidth: 590rpx;\r\n\tmargin-left: 98rpx;\r\n\tmargin-top: 10rpx;\r\n\tborder-left: 2rpx solid #bbbbbb;\r\n\tpadding-left: 20rpx;\r\n}\r\n</style>",null,null,null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BAgHO;+BAJA;;;+BAgDE;;;kBAnGP,MAAU;YACT,IAAI,CAAC,eAAe;YACpB,QAAQ,wBAAuB,IAAI,CAAC,oBAAoB;QACzD;;oBACA,MAAY;YACX,SAAS,wBAAuB,IAAI,CAAC,oBAAoB;QAC1D;;;;;;;;;;;YA9DD,mBAGO,QAAA,SAHD,WAAM,oBAAiB;gBAC5B,mBAAgF,QAAA,SAA1E,WAAM,kBAAe,gBAAI,IAAA,KAAA,OAAO;oBAAA,KAAM,KAAA,aAAa,GAAA;;oBAAA;;gBAAA,GAAA,CAAA;4BACtB,KAAA,OAAO;oBAA1C,mBAAyE,QAAA,qBAAnE,WAAM,kCAAmC,KAAA,aAAa,IAAG,OAAG,CAAA;;;;;uBAExD,KAAA,WAAW,CAAC,MAAM,IAAA,CAAA,IAAA,CAAU,KAAA,WAAW;gBAAlD,YAAwE,gBAAA,qBAApB,WAAM;;;;;YAC1D,mBAoBO,UAAA,IAAA,EAAA,cAAA,UAAA,CApBkC,KAAA,WAAW,EAAA,IAAtB,IAAG,KAAH,GAAE,IAAA,MAAA;uBAAhC,mBAoBO,QAAA,SApBD,WAAM,WAA2C,SAAK;oBAC3D,mBAIO,QAAA,SAJD,WAAM,SAAM;wBACjB,YAAkG,mBAAA,SAAzF,SAAK,GAAG,MAAM,EAAE,WAA4B,eAA5B,SAAA,kBAAA,WAA8B,aAAK,KAAA;4BAAE,KAAA,aAAa,CAAC,GAAG,OAAO;wBAAA;;;;;;wBACtF,mBAAsF,QAAA,SAAhF,WAAM,oBAAoB,aAAK,KAAA;4BAAE,KAAA,aAAa,CAAC,GAAG,OAAO;wBAAA;2CAAM,GAAG,IAAI,GAAA,CAAA,EAAA;4BAAA;yBAAA;wBAC5E,mBAAsD,QAAA,SAAhD,WAAM,iBAAc,gBAAI,GAAG,WAAW,GAAA,CAAA;;oBAE7C,mBAAqD,QAAA,SAA/C,WAAM,oBAAiB,gBAAI,GAAG,OAAO,GAAA,CAAA;oBAGJ,IAAA,GAAG,KAAK,IAAA,IAAA;wBAA/C,mBAA6O,aAAA,qBAAlO,WAAM,iBAAyC,YAAO,mDAAA,GAAA,KAAA,EAAA,UAAA,OAAA,GAAA,KAAA,EAAA,OAAA,qBAAA,GAAA,KAAA,EAAA,UAAA,YAAgI,iBAAW,KAAA,mBAAmB;;;;;;;;oBAG3K,IAAA,GAAG,WAAW,GAAA,CAAA;wBAAlE,mBAGO,QAAA,qBAHD,WAAM,SAAQ,iBAAY,eAAyC,aAAK,KAAA;4BAAE,KAAA,iBAAiB,CAAC,GAAG,EAAE;wBAAA;4BACtG,mBAAuD,QAAA,SAAjD,WAAM,eAAY,gBAAI,GAAG,WAAW,IAAG,OAAG,CAAA;4BAChD,mBAAuD,QAAA,SAAjD,WAAM,wBAAqB,gBAAI;;;;;wBAGtC,mBAEO,QAAA,qBAFD,WAAM,SAAS,WAAK,eAAE,IAAA,KAAA,OAAO;4BAAA;;4BAAA;;wBAAA,GAA+B,iBAAY,eAAsB,aAAK,KAAA;4BAAE,KAAA,WAAW,CAAC,GAAG,IAAI,EAAC,GAAG,EAAE;wBAAA;;4BACnI,mBAAkC,QAAA,SAA5B,WAAM,eAAa;;;;;;;;uBAIP,KAAA,WAAW,IAAI,KAAA,WAAW,CAAC,MAAM,GAAA,CAAA;gBAArD,YAAgH,yBAAA,qBAApD,aAAS,KAAA,OAAO,EAAG,aAAS,KAAA,OAAO;;;;;;;;;;;;;aAsC5F;aACA;aACA;aACA;aACA;;;wBAJA,iBAAa,2BACb,aAAQ,KAAK,EACb,iBAAY,CAAC,EACb,aAAQ,KAAK,EACb,iBAAY,IAAG;;;aAIhB,sBAAA,IAAoB,GAAE,yBAAyB,EAAC;YAC/C,iCACC,MAAK,EAAE,MAAM,CAAC,IAAG,CAAE,EAAC,CAAE,MAAK;QAE7B;;aAEA,cAAA,IAAY,MAAK,MAAK,CAAQ,EAAC,UAAS,MAAM,EAAC;YAC9C,IAAM,cAAc,QAAM;YAC1B,IAAI,CAAC,OAAK,CAAC,mBACV,cAAA,aACA,WAAA;QAEF;;aAEA,uBAAA,IAAqB,cAAa,EAAC;YAElC,IAAG,CAAC,IAAI,CAAC,OAAM,IAAK,EAAE,UAAS,IAAK,IAAI,EAAC;gBACxC,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,IAAC,iBAAe,OAAM;2BAAK,EAAE,EAAC,IAAK,EAAE,UAAU;;gBAClF,IAAG,KAAK,CAAC,CAAC;oBAAE;;gBAEZ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,WAAU,GAAI,KAAK,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,WAAU,GAAI,CAAC;YACjF,OAEK;gBACJ,IAAI,CAAC,WAAU;oBAAM;yBAAK,IAAI,CAAC,WAAU;YAC1C;QACD;;aACA,gBAAA,IAAc,SAAQ,MAAM,EAAC;YAC5B,iCACC,MAAK,0CAAwC;QAE/C;;aACA,oBAAA,IAAkB,IAAG,MAAM,EAAC;YAC3B,iCACC,MAAK,6CAA2C;QAElD;;aACA,kBAAA,MAAiB;YAChB,IAAG,IAAI,CAAC,OAAM,IAAK,IAAI,CAAC,OAAO,EAAC;gBAC/B;YACD;YACA,IAAI,CAAC,OAAM,GAAI,IAAG;YAClB,IAAM,OAAO,KAAK,KAAK,CAAC,IAAI,CAAC,WAAW;YACxC,IAAI,MAAM,AAAC,cAAW,IAAI,CAAC,UAAU,GAAC,cAAW;YAGjD,IAAG,IAAI,CAAC,OAAO,EAAC;gBACf,MAAM,AAAC,cAAW,IAAI,CAAC,UAAU,GAAC,cAAW;YAC9C;YAEA,sDACC,MAAI,OAAO,MACX,UAAS,IAAA,IAAO;gBACf,IAAI,IAAI,IAAI,IAAG;gBACf,IAAG,KAAK,IAAI;oBAAE;;gBACd,IAAG,IAAI,UAAS,IAAI,GAAG,EAAC;oBACvB,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;oBAEP;gBACD;gBACA,IAAM,UAAU,EAAE,IAAG,CAAE,EAAC;gBACxB,IAAG,WAAW,IAAI;oBAAE;;gBAGpB,IAAI,CAAC,OAAM,GAAI,QAAQ,SAAQ,IAAK,QAAQ,YAAW;gBACvD,IAAG,IAAI,CAAC,WAAU,IAAK,CAAC,EAAC;oBACxB,IAAI,CAAC,WAAU,GAAI,QAAQ,IAAG;gBAC/B,OAAO;oBACN,IAAI,CAAC,WAAW,CAAC,IAAI,EAAI,QAAQ,IAAI;gBACtC;gBAGA,IAAI,CAAC,WAAU,GAAI,IAAA,IAAI,CAAC,OAAM;oBAAI,QAAQ,YAAW;;oBAAI,KAAK,KAAK,CAAC,QAAQ,YAAW,GAAI,CAAC;;gBAAA;YAC7F;cACA,OAAM,IAAC,IAAQ;gBACd,+BACC,QAAO,IAAI,MAAM,EACjB,OAAM;YAER;cACA,WAAU,MAAM;gBACf,IAAI,CAAC,OAAM,GAAI,KAAI;gBACnB,IAAI,CAAC,WAAU,GAAI,KAAI;YACxB;;QAEF;;;sBAvFA,sBAAoB,GAAE;sBAMtB,cAAY,MAAK,MAAK,GAAS,UAAS,MAAM;sBAQ9C,uBAAqB;sBAarB,gBAAc,SAAQ,MAAM;sBAK5B,oBAAkB,IAAG,MAAM;sBAK3B;;mBA3EK;;;;;;;;;;;;;;gHAIK,CAAA,6DAIA,CAAA,2DAKD,KAAI,6DAKJ,CAAA"}