{"version":3,"sources":["components/upload-images/upload-images.uvue","pages/user-editinfo/user-editinfo.uvue?type=page","components/feedback-item/feedback-item.uvue","components/article-list-item/article-list-item.uvue","common/socket.uts"],"sourcesContent":["<template>\n\t<view class=\"upload-images\">\r\n\t\t<view class=\"upload-item\" v-for=\"(img,index) in imageList\" :key=\"img.id\">\r\n\t\t\t<image :src=\"img.src\" mode=\"aspectFill\" class=\"upload-img\" @click=\"previewImage(img.src)\"></image>\r\n\t\t\t<!-- 取消按钮 -->\r\n\t\t\t<text class=\"iconfont upload-close\" @click=\"remove(index)\">x</text>\r\n\t\t\t<!-- 上传进度 -->\r\n\t\t\t<view class=\"upload-progress\" v-if=\"img.err != '' || img.progress < 100\">\r\n\t\t\t\t<text class=\"upload-progress-data\">{{ img.err != '' ? img.err : (img.progress + '%') }}</text>\r\n\t\t\t</view>\r\n\t\t</view>\n\t\t<view class=\"upload-btn upload-item\" @click=\"chooseImageUpload\" v-if=\"count > 0\">\r\n\t\t\t<text class=\"iconfont upload-btn-icon\">+</text>\r\n\t\t</view>\n\t</view>\n</template>\n\n<script>\r\n\timport { defaultResult } from \"@/common/type.uts\"\r\n\timport { getURL } from '@/common/request.uts'\r\n\timport { getToken } from '@/store/user.uts'\r\n\timport { generateUniqueId } from '@/common/utils.uts'\r\n\ttype ImageItem = {\r\n\t\tid: string\r\n\t\tsrc: string\r\n\t\tprogress: number\r\n\t\terr: string\r\n\t\ttask: UploadTask | null\r\n\t}\n\texport default {\n\t\tname:\"upload-images\",\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\timageList: [] as ImageItem[]\n\t\t\t};\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 剩余可选上传图片数\r\n\t\t\tcount(): number {\r\n\t\t\t\treturn 9 - this.imageList.length \r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 判断是否还有没上传的图片\r\n\t\t\tisUploading():boolean {\r\n\t\t\t\tlet result = false\r\n\t\t\t\tthis.imageList.forEach((o:ImageItem)=>{\r\n\t\t\t\t\tif(o.progress < 100 && o.err == \"\"){\r\n\t\t\t\t\t\tresult = true\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn result\r\n\t\t\t},\r\n\t\t\t// 获取已上传图片地址\r\n\t\t\tgetValue(): string[] {\r\n\t\t\t\tlet arr = [] as string[]\r\n\t\t\t\tthis.imageList.forEach((o:ImageItem)=>{\r\n\t\t\t\t\tif(o.progress == 100){\r\n\t\t\t\t\t\tarr.push(o.src)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn arr\r\n\t\t\t},\r\n\t\t\t// 删除图片\r\n\t\t\tremove(index: number){\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '是否要删除该图片？',\r\n\t\t\t\t\tconfirmText: '删除',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif(!res.confirm){\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet item = this.imageList[index]\r\n\t\t\t\t\t\t// 如果还在上传中，先中端\r\n\t\t\t\t\t\tif(item.progress < 100 && item.task != null && item.err == \"\"){\r\n\t\t\t\t\t\t\t// 取消上传\r\n\t\t\t\t\t\t\titem.task?.abort()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 移除\r\n\t\t\t\t\t\tthis.imageList.splice(index,1)\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tpreviewImage(current : string) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent,\r\n\t\t\t\t\turls: this.imageList.map((o:ImageItem):string => o.src)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchooseImageUpload(){\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: this.count,\r\n\t\t\t\t\tsizeType: [\"compressed\"],\r\n\t\t\t\t\tsourceType: [\"album\"],\r\n\t\t\t\t\tsuccess:(res: ChooseImageSuccess)=>{\r\n\t\t\t\t\t\tlet length = res.tempFilePaths.length\r\n\t\t\t\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\t\t\t\tlet src = res.tempFilePaths[i]\r\n\t\t\t\t\t\t\tthis.upload(src)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 上传\r\n\t\t\tupload(src:string){\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\tid:generateUniqueId(),\r\n\t\t\t\t\tsrc,\r\n\t\t\t\t\tprogress: 0, \r\n\t\t\t\t\terr: \"\",\r\n\t\t\t\t\ttask: null\r\n\t\t\t\t} as ImageItem\r\n\t\t\t\t\r\n\t\t\t\tlet i = this.imageList.length\r\n\t\t\t\tthis.imageList.push(item)\r\n\t\t\t\titem.task = uni.uploadFile({\r\n\t\t\t\t\turl:getURL(\"/upload\"),\r\n\t\t\t\t\tfilePath: src,\r\n\t\t\t\t\tname:\"image\",\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\t\tlet d = JSON.parse<defaultResult>(res.data)\r\n\t\t\t\t\t\tif(d == null) return\r\n\t\t\t\t\t\tif(d.code == 0){\r\n\t\t\t\t\t\t\tthis.imageList[i].err = \"上传失败\"\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: d.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.imageList[i].src = d.data as string\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail:(_)=>{\r\n\t\t\t\t\t\tthis.imageList[i].err = \"上传失败\"\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\t// 上传进度\r\n\t\t\t\titem.task?.onProgressUpdate((res:OnProgressUpdateResult)=>{\r\n\t\t\t\t\tthis.imageList[i].progress = res.progress\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\n\t}\n</script>\n\n<style>\n.upload-images {\r\n\tflex-direction: row;\r\n\tflex-wrap: wrap;\r\n\tpadding: 0 14rpx;\r\n}\r\n.upload-item {\r\n\twidth: 220rpx;\r\n\theight: 220rpx;\r\n\tborder-radius: 5px;\r\n\tmargin: 10rpx;\r\n\toverflow: hidden;\r\n\tposition: relative;\r\n}\r\n.upload-img {\r\n\twidth: 220rpx;\r\n\theight: 220rpx;\r\n}\r\n\r\n.upload-close {\r\n\tposition: absolute;\r\n\tright: 0;\r\n\ttop: 0;\r\n\tz-index: 100;\r\n\twidth: 50rpx;\r\n\theight: 50rpx;\r\n\ttext-align: center;\r\n\tline-height: 50rpx;\r\n\tcolor: #ffffff;\r\n\tbackground-color: rgba(0, 0, 0, 0.1);\r\n\tborder-radius: 5px;\r\n}\r\n\r\n.upload-btn {\r\n\tborder: 1px solid #e2e2e2;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n}\r\n.upload-btn-icon {\r\n\tfont-size: 60px;\r\n\tcolor: #e2e2e2;\r\n}\r\n.upload-progress {\r\n\twidth: 220rpx;\r\n\theight: 220rpx;\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tright: 0;\r\n\tbackground-color: rgba(0, 0, 0, 0.3);\r\n\tz-index: 99;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tflex-direction: row;\r\n}\r\n.upload-progress-data {\r\n\tfont-size: 14px;\r\n\tcolor: #ffffff;\r\n}\n</style>",null,null,null,null],"names":[],"mappings":"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"}