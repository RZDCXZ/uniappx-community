{"version":3,"sources":["components/follow-button/follow-button.uvue","common/socket.uts"],"sourcesContent":["<template>\r\n\t<main-btn v-if=\"type == 'main-btn'\" @click.stop=\"handleFollow\" width=\"330rpx\" height=\"65rpx\">{{ modelValue ? '已关注' : '关注' }}</main-btn>\n\t<text v-else class=\"follow\" :class=\"{  ['follow-' + type] : true,'follow-active':modelValue }\" @click.stop=\"handleFollow\">{{ modelValue ? '已关注' : '关注' }}</text>\r\n\t<!-- <image v-show=\"loading\" src=\"@/static/loading1.gif\" mode=\"widthFix\" style=\"width: 30px;margin-left: auto;\"></image> -->\n</template>\n\n<script>\r\n\timport type { defaultResult,updateArticleChangeEvent } from '@/common/type.uts'\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { AuthAction,getToken } from '@/store/user.uts'\n\texport default {\r\n\t\temits:[\"update:modelValue\"],\n\t\tname:\"follow-button\",\r\n\t\tprops: {\r\n\t\t\tmodelValue: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\t// 被关注人ID\r\n\t\t\tuser_id:{\r\n\t\t\t\ttype:Number,\r\n\t\t\t\tdefault:0\r\n\t\t\t},\r\n\t\t\ttype:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault:\"text\"\r\n\t\t\t}\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tloading:false\n\t\t\t};\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 关注/取消关注\r\n\t\t\thandleFollow() {\r\n\t\t\t\tAuthAction(()=>{\r\n\t\t\t\t\tif(this.loading) return\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.loading = true\r\n\t\t\t\t\t// 判断是关注还是取消关注\r\n\t\t\t\t\tlet action = this.modelValue ? 'remove_follow' : 'add_follow'\r\n\t\t\t\t\tuni.request<defaultResult>({\r\n\t\t\t\t\t\turl: getURL(`/${action}/${this.user_id}`),\r\n\t\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\t\theader:{\r\n\t\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 全局通知\r\n\t\t\t\t\t\t\tuni.$emit(\"onUpdateArticleChange\",{\r\n\t\t\t\t\t\t\t\t// 被关注用户ID\r\n\t\t\t\t\t\t\t\tid:this.user_id,\r\n\t\t\t\t\t\t\t\t// 事件标识\r\n\t\t\t\t\t\t\t\tkey:\"updateFollow\",\r\n\t\t\t\t\t\t\t\t// 转成string，方便后期其他事件传递其他参数\r\n\t\t\t\t\t\t\t\tvalue: this.modelValue ? \"false\" : \"true\"\r\n\t\t\t\t\t\t\t} as updateArticleChangeEvent)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.$emit(\"update:modelValue\",!this.modelValue)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\n\t}\n</script>\n\n<style>\n.follow {\r\n\tfont-size: 15px;\r\n\tfont-weight: bold;\r\n\tmargin-left: auto;\r\n}\r\n.follow-text {\r\n\tcolor: #de6489;\r\n\tpadding: 10rpx;\r\n}\r\n.follow-plain {\r\n\tcolor: #de6489;\r\n\tborder: 1rpx solid #de6489;\r\n\tborder-radius: 6px;\r\n\tpadding: 10rpx 25rpx;\r\n\tfont-size: 14px;\r\n}\r\n.follow-button {\r\n\tborder-radius: 6px;\r\n\tbackground-color:#de6489;\r\n\tcolor: #ffffff;\r\n\tpadding: 10rpx 25rpx;\r\n}\r\n.follow-active {\r\n\tcolor: #9a9a9a;\r\n\tbackground-color: #ffffff;\r\n\tborder-color: #ffffff;\r\n}\n</style>",null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BAmFO;;;;;;;;;;eAlFU,IAAA,KAAA,IAAI,IAAA;YAApB,YAAuI,qBAAA,qBAAlG,aAAK,cAAO,KAAA,YAAY,EAAA;gBAAA;aAAA,GAAE,WAAM,UAAS,YAAO,4CAAQ,gBAA+B,GAAA;uBAAA;oBAAA,gBAA5B,IAAA,KAAA,UAAU;wBAAA;;wBAAA;qBAAA;iBAAA;;;;;YAC1G,mBAAgK,QAAA,qBAAnJ,WAAK,eAAA;gBAAC;gBAAiB,SAAA,YAAA,KAAA,IAAA,IAAA,IAAA,EAAA,mBAAA,KAAA,UAAA;aAAyD,GAAG,aAAK,cAAO,KAAA,YAAY,EAAA;gBAAA;aAAA,oBAAK,IAAA,KAAA,UAAU;gBAAA;;gBAAA;;YAAA,GAAA,EAAA,EAAA;gBAAA;aAAA;;QAAA;;;;;aA4BpI;;;wBAAA,aAAQ,KAAI;;;aAKb,eAAA,MAAe;YACd,WAAW,KAAI;gBACd,IAAG,IAAI,CAAC,OAAO;oBAAE;;gBAEjB,IAAI,CAAC,OAAM,GAAI,IAAG;gBAElB,IAAI,SAAS,IAAA,IAAI,CAAC,UAAS;oBAAI;;oBAAkB;;gBAAW;gBAC5D,0CACC,MAAK,OAAO,AAAC,MAAG,SAAO,MAAG,IAAI,CAAC,OAAO,GACtC,SAAO,QACP,SAAO;oBACN,IAAA,QAAM;iBACN,EACD,UAAS,IAAC,IAAQ;oBACjB,IAAI,IAAI,IAAI,IAAG;oBACf,IAAG,KAAK,IAAI;wBAAE;;oBACd,IAAG,IAAI,UAAS,IAAI,GAAG,EAAC;wBACvB,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;wBAEP;oBACD;oBAEA,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;oBAIP,UAAU,kDAET,KAAG,IAAI,CAAC,OAAO,EAEf,MAAI,gBAEJ,QAAO,IAAA,IAAI,CAAC,UAAS;wBAAI;;wBAAU;;oBAAK;oBAGzC,IAAI,CAAC,OAAK,CAAC,qBAAoB,CAAC,IAAI,CAAC,UAAU;gBAChD;kBACA,OAAM,IAAC,IAAQ;oBACd,+BACC,QAAO,IAAI,MAAM,EACjB,OAAM;gBAER;kBACA,WAAU,MAAM;oBACf,WAAW,KAAI;wBACd,IAAI,CAAC,OAAM,GAAI,KAAI;oBACpB;sBAAG,GAAG;gBACP;;YAEF;;QACD;;;sBAtDA;;mBAvBI;;;;;;;;;;;;;;8GAIM,KAAI,0DAKL,CAAA,uDAIA"}