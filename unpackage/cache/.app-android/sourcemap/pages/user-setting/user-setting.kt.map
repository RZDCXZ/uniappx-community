{"version":3,"sources":["pages/user-setting/user-setting.uvue","pages/user-setting/user-setting.uvue?type=page","components/article-list-item/article-list-item.uvue","components/topic-list-item/topic-list-item.uvue","store/user.uts","common/socket.uts"],"sourcesContent":["<template>\r\n\r\n\t<scroll-view style=\"flex:1\">\r\n\r\n\t\t<cell title=\"账号与安全\" @click=\"open('user-safe')\"></cell>\r\n\t\t<cell title=\"资料编辑\" @click=\"open('user-editinfo')\"></cell>\r\n\t\t<cell title=\"清除缓存\" :right-text=\"currentSize\" :show-arrow=\"false\" @click=\"clearStorage\"></cell>\r\n\t\t<cell title=\"意见反馈\" @click=\"open('user-feedback')\"></cell>\r\n\t\t<cell title=\"关于社区\" @click=\"open('about')\"></cell>\r\n\t\t<view class=\"flex-center\" style=\"padding: 20rpx 0;\" v-if=\"loginState\">\r\n\t\t\t<main-btn width=\"600rpx\" @click=\"logout\">退出登录</main-btn>\r\n\t\t</view>\r\n\r\n\t</scroll-view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { loginState,getToken,logout,userState,AuthNavigateTo } from \"@/store/user.uts\"\r\n\timport type { defaultResult } from \"@/common/type.uts\"\r\n\t// 缓存白名单\r\n\tconst whites = [\"user_info\",\"user_token\"] as string[]\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 本地缓存大小\r\n\t\t\t\tcurrentSize:\"\",\r\n\t\t\t\t// 需要清除的key\r\n\t\t\t\tkeys:[] as string[]\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tloginState(): boolean {\r\n\t\t\t\treturn loginState.value\r\n\t\t\t},\r\n\t\t\tid():number{\r\n\t\t\t\treturn userState.id\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.getStorageInfo()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tlogout(){\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\tcontent: '是否要退出登录？',\r\n\t\t\t\t\tconfirmText: '立即退出',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif(!res.confirm) return\r\n\t\t\t\t\t\t// 退出登录操作\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: '退出登录中...',\r\n\t\t\t\t\t\t\tmask: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.request<defaultResult>({\r\n\t\t\t\t\t\t\turl: getURL('/user/logout'),\r\n\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\theader:{\r\n\t\t\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t\t// 清除本地缓存\r\n\t\t\t\t\t\t\t\tlogout()\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '退出成功',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// 返回上一页\r\n\t\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\t\t\t\tdelta: 1\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetStorageInfo(){\r\n\t\t\t\tuni.getStorageInfo({\r\n\t\t\t\t\tsuccess:res=>{\r\n\t\t\t\t\t\tthis.currentSize = res.currentSize > 1024 ? (res.currentSize/1024).toFixed(2) + 'MB' : res.currentSize.toFixed(2) + 'KB'\r\n\t\t\t\t\t\t// 排除白名单\r\n\t\t\t\t\t\tthis.keys = res.keys.filter((k:string):boolean =>  !whites.includes(k))\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tclearStorage(){\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '是否要清除缓存？',\r\n\t\t\t\t\tconfirmText: '立即清除',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif(res.confirm){\r\n\t\t\t\t\t\t\t// 移除缓存\r\n\t\t\t\t\t\t\tfor (let i = 0; i < this.keys.length; i++) {\r\n\t\t\t\t\t\t\t\tuni.removeStorageSync(this.keys[i])\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// 重新获取缓存大小\r\n\t\t\t\t\t\t\tthis.getStorageInfo()\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '清除缓存成功',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen(p:string){\r\n\t\t\t\tlet url = `/pages/${p}/${p}`\r\n\t\t\t\t\r\n\t\t\t\t// 需要登录后才能打开的页面\r\n\t\t\t\tif(p == \"user-safe\" || p == \"user-feedback\" || p == \"user-editinfo\"){\r\n\t\t\t\t\tAuthNavigateTo(`${url}?user_id=${this.id}`)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n",null,null,null,null,null],"names":[],"mappings":"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"}