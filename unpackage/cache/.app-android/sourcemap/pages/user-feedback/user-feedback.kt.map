{"version":3,"sources":["pages/user-feedback/user-feedback.uvue","pages/user-feedback/user-feedback.uvue?type=page","common/socket.uts","pages/index/index.uvue?type=page"],"sourcesContent":["<template>\r\n\r\n\t<scroll-view style=\"flex:1\">\r\n\r\n\t\t<!-- 反馈列表 -->\r\n\t\t<feedback-item v-for=\"(item,index) in List\" :key=\"index\" :item=\"item\"></feedback-item>\r\n\t\t\r\n\t\t<!-- loading -->\r\n\t\t<loading :circle=\"true\" v-if=\"loading && List.length == 0\"></loading>\r\n\t\t\r\n\t\t<view v-if=\"!isFirstLoad && List.length == 0\" class=\"flex-1\">\r\n\t\t\t<tip />\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 用于滚动底部 -->\r\n\t\t<view id=\"chat-bottom\"></view>\r\n\t\t\r\n\t\t<navigator url=\"/pages/user-feedback-form/user-feedback-form\">\r\n\t\t\t<view class=\"feedback-action\">\r\n\t\t\t\t<text class=\"iconfont feedback-action-icon\">{{ '\\ue668' }}</text>\r\n\t\t\t\t<text class=\"feedback-action-text\">意见反馈</text>\r\n\t\t\t</view>\r\n\t\t</navigator>\r\n\t\t\r\n\t\t<view style=\"height: 95rpx;\"></view>\r\n\t\t\r\n\r\n\t</scroll-view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport { FeedbackItem,FeedbackItemResult,Result } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { getToken } from \"@/store/user.uts\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tList: [] as FeedbackItem[],\r\n\t\t\t\tloading: false,\r\n\t\t\t\tisEnded: false,\r\n\t\t\t\tcurrentPage: 1,\r\n\t\t\t\tisFirstLoad:true\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.refreshData(()=>{\r\n\t\t\t\t// 回到底部\r\n\t\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\t\tthis.goToBottom()\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tthis.loadData(()=>{\r\n\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t})\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tgoToBottom(){\r\n\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\tselector:\"#chat-bottom\",\r\n\t\t\t\t\tduration: 100\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\trefreshData(loadComplete : (() => void) | null) {\r\n\t\t\t\tthis.List.length = 0\r\n\t\t\t\tthis.currentPage = 1\r\n\t\t\t\tthis.isFirstLoad = true\r\n\t\t\t\tthis.isEnded = false\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tthis.loadData(loadComplete)\r\n\t\t\t},\r\n\t\t\tloadData(loadComplete : (() => void) | null) {\r\n\t\t\t\tif (this.loading || this.isEnded) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tuni.request<Result<FeedbackItemResult>>({\r\n\t\t\t\t\turl: getURL(`/feedback/${Math.floor(this.currentPage)}`),\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst resData = r.data as FeedbackItemResult | null\r\n\t\t\t\t\t\tif(resData == null) return\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 倒序排序，最新的数据在下面\r\n\t\t\t\t\t\tresData.data.sort((a:FeedbackItem,b:FeedbackItem):number => a.id - b.id)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 是否还有数据\r\n\t\t\t\t\t\tthis.isEnded = resData.last_page <= resData.current_page\r\n\t\t\t\t\t\tif(this.currentPage == 1){\r\n\t\t\t\t\t\t\tthis.List = resData.data\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.List = [ ...resData.data, ...this.List ]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 页码+1\r\n\t\t\t\t\t\tthis.currentPage = this.isEnded ? resData.current_page : Math.floor(resData.current_page + 1)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t\tthis.isFirstLoad = false\r\n\t\t\t\t\t\tif (loadComplete != null) {\r\n\t\t\t\t\t\t\tloadComplete()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n.feedback-action {\r\n\tposition: fixed;\r\n\tbottom: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\theight: 95rpx;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tbackground-color: #ffffff;\r\n\tborder-top: 1px solid #eeeeee;\r\n}\r\n.feedback-action-icon {\r\n\tmargin-right: 20rpx;\r\n}\r\n.feedback-action-text {\r\n\tfont-size: 16px;\r\n}\r\n</style>",null,null,null],"names":[],"mappings":"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"}