{"version":3,"sources":["pages/choose-topic/choose-topic.uvue","components/article-list-item/article-list-item.uvue","common/socket.uts","pages/choose-topic/choose-topic.uvue?type=page"],"sourcesContent":["<template>\n\t<view class=\"flex-1 flex\" style=\"border-top: 1rpx solid #f2f2f2;\">\r\n\t\t<scroll-view scroll-y=\"true\" class=\"topic-navs\">\r\n\t\t\t<view v-for=\"tn in topic_navs\" :key=\"tn.id\" class=\"topic-nav-item\" :style=\"navActiveId == tn.id ? 'background-color:#ffffff;' : '' \" @click=\"chooseTopicNav(tn.id)\">\r\n\t\t\t\t<text :style=\" navActiveId == tn.id ? 'color:#e95e6f' : 'color:#0c0c0c' \">{{ tn.title }}</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t<view class=\"flex-1\" v-if=\"topic_list.length == 0\">\r\n\t\t\t<loading :circle=\"true\" v-if=\"loading\"></loading>\r\n\t\t\t<tip title=\"暂无话题~\" v-else></tip>\r\n\t\t</view>\r\n\t\t<list-view v-else class=\"flex-1\" style=\"padding-left: 34rpx;\" @scrolltolower=\"loadMore\">\r\n\t\t\t<topic-list-item v-for=\" item in topic_list \" :key=\"item.id\" :item=\"item\" :ischoose=\"true\"></topic-list-item>\r\n\t\t\t<list-item :type=\"4\">\r\n\t\t\t\t<loading-more :loading=\"loading\" :isEnded=\"isEnded\"></loading-more>\r\n\t\t\t</list-item>\r\n\t\t</list-view>\r\n\t</view>\n</template>\n\n<script>\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport type { TopicNav,Topic,Result,TopicResult } from \"@/common/type.uts\"\r\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\tnavActiveId:2,\n\t\t\t\ttopic_navs:[] as TopicNav[],\r\n\t\t\t\t\r\n\t\t\t\ttopic_list:[] as Topic[],\r\n\t\t\t\t\r\n\t\t\t\tpage:1,\r\n\t\t\t\tisEnded:false,\r\n\t\t\t\tloading:false\n\t\t\t}\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.loadCategories()\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t// 获取话题分类数据\r\n\t\t\tloadCategories(){\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '加载中...',\r\n\t\t\t\t\tmask: false\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tuni.request<Result<TopicNav[]>>({\r\n\t\t\t\t\turl: getURL('/category/topic'),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.topic_navs = r.data as TopicNav[]\r\n\t\t\t\t\t\t// 默认选中第一个\r\n\t\t\t\t\t\tif(this.topic_navs.length > 0){\r\n\t\t\t\t\t\t\tthis.chooseTopicNav(this.topic_navs[0].id)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 加载话题列表数据\r\n\t\t\tloadTopicList(){\r\n\t\t\t\t// 开启上拉加载状态\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\t\r\n\t\t\t\tuni.request<Result<TopicResult>>({\r\n\t\t\t\t\turl: getURL(`/category/${this.navActiveId}/topic/${this.page}`),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst resData = r.data as TopicResult | null\r\n\t\t\t\t\t\tif(resData == null) return\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 是否还有数据\r\n\t\t\t\t\t\tthis.isEnded = resData.last_page <= resData.current_page\r\n\t\t\t\t\t\tif(this.page == 1){\r\n\t\t\t\t\t\t\tthis.topic_list = resData.data\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.topic_list.push(...resData.data)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 页码+1\r\n\t\t\t\t\t\tthis.page = this.isEnded ? resData.current_page : Math.floor(resData.current_page + 1)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t\t// uni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 切换分类\n\t\t\tchooseTopicNav(id:number){\r\n\t\t\t\tthis.navActiveId = id\r\n\t\t\t\t\r\n\t\t\t\t// uni.showLoading({\r\n\t\t\t\t// \ttitle: '加载中...',\r\n\t\t\t\t// \tmask: true\r\n\t\t\t\t// });\r\n\t\t\t\t\r\n\t\t\t\t// 重置页码\r\n\t\t\t\tthis.isEnded = false\r\n\t\t\t\tthis.page = 1\r\n\t\t\t\tthis.topic_list.length = 0\r\n\t\t\t\t\r\n\t\t\t\tthis.loadTopicList()\r\n\t\t\t},\r\n\t\t\tloadMore(){\r\n\t\t\t\tif(this.loading || this.isEnded) return\r\n\t\t\t\tthis.loadTopicList()\r\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n.topic-navs {\r\n\twidth: 165rpx;\r\n\tbackground-color: #f9f9f9;\r\n}\r\n.topic-nav-item {\r\n\theight: 100rpx;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n}\n</style>\n",null,null,null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BA+HY;+BAIN;+BAvCI;;;;eAvDR,sBAAS;YACR,IAAI,CAAC,cAAc;QACpB;;;;;;;;;;;eAtCD,mBAgBO,QAAA,SAhBD,WAAM,eAAc,WAAuC,eAAvC,SAAA,gBAAA;YACzB,mBAIc,eAAA,SAJD,cAAS,QAAO,WAAM;gBAClC,mBAEO,UAAA,IAAA,EAAA,cAAA,UAAA,CAFY,KAAA,UAAU,EAAA,IAAhB,IAAA,GAAA,GAAE,IAAA,MAAA;2BAAf,mBAEO,QAAA,SAFyB,SAAK,GAAG,EAAE,EAAE,WAAM,kBAAkB,WAAK,eAAE,IAAA,KAAA,WAAW,IAAI,GAAG,EAAE;wBAAA;;wBAAA;;oBAAA,GAAuC,aAAK,KAAA;wBAAE,KAAA,cAAc,CAAC,GAAG,EAAE;oBAAA;;wBAChK,mBAA+F,QAAA,SAAxF,WAAK,eAAG,IAAA,KAAA,WAAW,IAAI,GAAG,EAAE;4BAAA;;4BAAA;;wBAAA,oBAA0C,GAAG,KAAK,GAAA,CAAA;;;;;;;YAG5D,IAAA,KAAA,UAAU,CAAC,MAAM,IAAA,CAAA;gBAA5C,mBAGO,QAAA,qBAHD,WAAM;+BACmB,KAAA,OAAO;wBAArC,YAAiD,oBAAA,qBAAvC,YAAQ,IAAI;;wBACtB,YAAgC,gBAAA,qBAA3B,WAAM;;;;gBAEZ,mBAKY,aAAA,qBALM,WAAM,UAAS,WAA4B,eAA5B,SAAA,kBAAA,WAA8B,qBAAe,KAAA,QAAQ;oBACrF,mBAA6G,UAAA,IAAA,EAAA,cAAA,UAAA,CAA5E,KAAA,UAAU,EAAA,IAAlB,MAAA,GAAA,GAAI,IAAA,MAAA;+BAA7B,YAA6G,4BAAA,SAA9D,SAAK,KAAK,EAAE,EAAG,UAAM,MAAO,cAAU,IAAI;;;;;oBACzF,mBAEY,aAAA,SAFA,UAAM,CAAC,GAAA;wBAClB,YAAmE,yBAAA,SAApD,aAAS,KAAA,OAAO,EAAG,aAAS,KAAA,OAAO;;;;;;;;;;;aAalD;aACA;aAEA;aAEA;aACA;aACA;;;wBAPA,iBAAY,CAAC,EACb,gBAAW,wBAEX,gBAAW,qBAEX,UAAK,CAAC,EACN,aAAQ,KAAK,EACb,aAAQ,KAAI;;;aAQb,iBAAA,MAAgB;YACf,mCACC,QAAO,UACP,OAAM,KAAI;YAGX,uDACC,MAAK,OAAO,oBACZ,UAAS,IAAA,IAAO;gBACf,IAAI,IAAI,IAAI,IAAG;gBACf,IAAG,KAAK,IAAI;oBAAE;;gBACd,IAAG,IAAI,UAAS,IAAI,GAAG,EAAC;oBACvB,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;oBAEP;gBACD;gBACA,IAAI,CAAC,UAAS,GAAI,EAAE,IAAG,CAAE,EAAC;gBAE1B,IAAG,IAAI,CAAC,UAAU,CAAC,MAAK,GAAI,CAAC,EAAC;oBAC7B,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE;gBAC1C;YACD;cACA,OAAM,IAAC,IAAQ;gBACd,+BACC,QAAO,IAAI,MAAM,EACjB,OAAM;YAER;cACA,WAAU,MAAM;gBACf;YACD;;QAEF;;aAEA,gBAAA,MAAe;YAEd,IAAI,CAAC,OAAM,GAAI,IAAG;YAElB,gDACC,MAAK,OAAO,AAAC,eAAY,IAAI,CAAC,WAAW,GAAC,YAAS,IAAI,CAAC,IAAI,GAC5D,UAAS,IAAA,IAAO;gBACf,IAAI,IAAI,IAAI,IAAG;gBACf,IAAG,KAAK,IAAI;oBAAE;;gBACd,IAAG,IAAI,UAAS,IAAI,GAAG,EAAC;oBACvB,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;oBAEP;gBACD;gBAEA,IAAM,UAAU,EAAE,IAAG,CAAE,EAAC;gBACxB,IAAG,WAAW,IAAI;oBAAE;;gBAGpB,IAAI,CAAC,OAAM,GAAI,QAAQ,SAAQ,IAAK,QAAQ,YAAW;gBACvD,IAAG,IAAI,CAAC,IAAG,IAAK,CAAC,EAAC;oBACjB,IAAI,CAAC,UAAS,GAAI,QAAQ,IAAG;gBAC9B,OAAO;oBACN,IAAI,CAAC,UAAU,CAAC,IAAI,EAAI,QAAQ,IAAI;gBACrC;gBAGA,IAAI,CAAC,IAAG,GAAI,IAAA,IAAI,CAAC,OAAM;oBAAI,QAAQ,YAAW;;oBAAI,KAAK,KAAK,CAAC,QAAQ,YAAW,GAAI,CAAC;;gBAAA;YACtF;cACA,OAAM,IAAC,IAAQ;gBACd,+BACC,QAAO,IAAI,MAAM,EACjB,OAAM;YAER;cACA,WAAU,MAAM;gBACf,IAAI,CAAC,OAAM,GAAI,KAAI;YAEpB;;QAEF;;aAEA,iBAAA,IAAe,IAAG,MAAM,EAAC;YACxB,IAAI,CAAC,WAAU,GAAI;YAQnB,IAAI,CAAC,OAAM,GAAI,KAAI;YACnB,IAAI,CAAC,IAAG,GAAI,CAAA;YACZ,IAAI,CAAC,UAAU,CAAC,MAAK,GAAI,CAAA;YAEzB,IAAI,CAAC,aAAa;QACnB;;aACA,WAAA,MAAU;YACT,IAAG,IAAI,CAAC,OAAM,IAAK,IAAI,CAAC,OAAO;gBAAE;;YACjC,IAAI,CAAC,aAAa;QACnB;;;sBAlGA;sBAoCA;sBA4CA,iBAAe,IAAG,MAAM;sBAexB"}