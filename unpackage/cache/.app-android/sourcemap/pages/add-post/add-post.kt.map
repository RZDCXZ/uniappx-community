{"version":3,"sources":["pages/add-post/add-post.uvue","common/socket.uts","pages/long-list/long-list-page.uvue","components/article-list-item/article-list-item.uvue","components/topic-list-item/topic-list-item.uvue","store/user.uts","pages/add-post/add-post.uvue?type=page"],"sourcesContent":["<template>\r\n\t<navbar type=\"text\">\r\n\t\t<template #right>\r\n\t\t\t<view class=\"navbar-right\">\r\n\t\t\t\t<main-btn :disabled=\"disabled\" width=\"118rpx\" height=\"60rpx\" font-size=\"14px\" @click=\"submit\">发送</main-btn>\r\n\t\t\t</view>\r\n\t\t</template>\r\n\t</navbar>\r\n\r\n\t<scroll-view style=\"flex:1;background-color: #f4f4f4;\">\r\n\r\n\t\t<view style=\"background-color: #ffffff;\">\r\n\t\t\t<textarea :auto-focus=\"true\" :auto-height=\"true\" v-model=\"content\" placeholder=\"有标题和画面清晰无水印的作品曝光更多哦~\" class=\"add-textarea\"></textarea>\t\r\n\t\t\t<upload-images ref=\"upload\" style=\"margin-bottom: 60rpx;\"></upload-images>\r\n\t\t\t\r\n\t\t</view>\r\n\t\t\r\n\t\t<f-picker :range=\"range\" @confirm=\"handleChooseCategory\">\r\n\t\t\t<cell :title=\"'# ' + chooseCategoryTitle\" :rightText=\"chooseCategoryId == 0 ? '点击选择' : ''\">\r\n\t\t\t\t<text class=\"cell-tip\" v-if=\"chooseCategoryId == 0\">必填</text>\r\n\t\t\t</cell>\r\n\t\t</f-picker>\r\n\t\t\r\n\t\t<cell :title=\"'# '+ chooseTopicTitle\" :rightText=\"chooseTopicId == 0 ? '点击选择' : ''\" @click=\"openTopicPicker\">\r\n\t\t\t<text class=\"cell-tip\" v-if=\"chooseTopicId == 0\">让更多人看见</text>\r\n\t\t</cell>\r\n\t\t\r\n\r\n\t</scroll-view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport { articleNav,Result,TopicNav,defaultResult,onAddArticleSuccessEvent } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { getToken } from \"@/store/user.uts\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcontent:\"\",\r\n\t\t\t\t\r\n\t\t\t\tchooseCategoryTitle:\"选择分类\",\r\n\t\t\t\tchooseCategoryId:0,\r\n\t\t\t\t// 分类\r\n\t\t\t\tcategoryList:[{\r\n\t\t\t\t\tid:0,\r\n\t\t\t\t\ttitle:\"请选择\"\r\n\t\t\t\t}] as articleNav[],\r\n\t\t\t\t// 分类选项\r\n\t\t\t\trange:[] as string[],\r\n\t\t\t\t\r\n\t\t\t\tchooseTopicTitle:\"选择话题\",\r\n\t\t\t\tchooseTopicId:0\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tdisabled(): boolean {\r\n\t\t\t\treturn this.content.length == 0 || this.chooseCategoryId == 0\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options:OnLoadOptions) {\r\n\t\t\tif(options.has(\"topic_id\")){\r\n\t\t\t\tthis.chooseTopicId = parseInt(options.get(\"topic_id\") as string)\r\n\t\t\t}\r\n\t\t\tif(options.has(\"topic_title\")){\r\n\t\t\t\tthis.chooseTopicTitle = options.get(\"topic_title\") as string\r\n\t\t\t}\r\n\t\t\tthis.loadCategories()\r\n\t\t\tuni.$on(\"onTopicPickerSuccess\",this.onTopicPickerSuccess)\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off(\"onTopicPickerSuccess\",this.onTopicPickerSuccess)\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 选择话题结果\r\n\t\t\tonTopicPickerSuccess(e: TopicNav){\r\n\t\t\t\tthis.chooseTopicId = e.id\r\n\t\t\t\tthis.chooseTopicTitle = e.title\r\n\t\t\t},\r\n\t\t\t// 打开话题选择器\r\n\t\t\topenTopicPicker(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/choose-topic/choose-topic',\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 获取分类\r\n\t\t\tloadCategories(){\r\n\t\t\t\tuni.request<Result<articleNav[]>>({\r\n\t\t\t\t\turl: getURL('/category/article'),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet d = r.data as articleNav[]\r\n\t\t\t\t\t\tthis.categoryList.push(...d)\r\n\t\t\t\t\t\tthis.range = this.categoryList.map((o:articleNav) : string => o.title)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 发布帖子\r\n\t\t\tsubmit(){\r\n\t\t\t\t// 拿到上传组件节点\r\n\t\t\t\tconst uploadRef = this.$refs[\"upload\"] as ComponentPublicInstance\r\n\t\t\t\t// 判断是否还有图片正在上传\r\n\t\t\t\tif(uploadRef.$callMethod(\"isUploading\") as boolean){\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '还有图片正在上传中...',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 获取图片数组\r\n\t\t\t\tlet images = uploadRef.$callMethod(\"getValue\") as string[]\r\n\t\t\t\t// 请求参数\r\n\t\t\t\tlet data = {\r\n\t\t\t\t  images,\r\n\t\t\t\t  content:this.content,\r\n\t\t\t\t  category_id: this.chooseCategoryId,\r\n\t\t\t\t  topic_id:this.chooseTopicId\r\n\t\t\t\t} as  UTSJSONObject\r\n\t\t\t\t\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '发布中...',\r\n\t\t\t\t\tmask: false\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tuni.request<defaultResult>({\r\n\t\t\t\t\turl: getURL(\"/article/save\"),\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 请求失败\r\n\t\t\t\t\t\tif(res.statusCode != 200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 刷新首页/话题详情页\r\n\t\t\t\t\t\tuni.$emit(\"onAddArticleSuccess\",{\r\n\t\t\t\t\t\t\tcategory_id:this.chooseCategoryId,\r\n\t\t\t\t\t\t\ttopic_id:this.chooseTopicId\r\n\t\t\t\t\t\t} as onAddArticleSuccessEvent)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\t\tdelta: 1\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\thandleChooseCategory(i:number){\r\n\t\t\t\tlet item = this.categoryList[i] as articleNav\r\n\t\t\t\tthis.chooseCategoryId = item.id\r\n\t\t\t\tthis.chooseCategoryTitle = item.title\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n.navbar-right {\r\n\theight: 45px;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tmargin-right: 34rpx;\r\n}\r\n.cell-tip {\r\n\tcolor: #f0748a;\r\n\tbackground-color: #fff1f6;\r\n\tborder-radius: 4px;\r\n\tmargin-left: 18rpx;\r\n\tfont-size: 13px;\r\n\tpadding: 5rpx 10rpx;\r\n}\r\n.add-textarea {\r\n\twidth: 750rpx;\r\n\tmax-height: 500rpx;\r\n\tpadding: 60rpx 30rpx;\r\n}\r\n</style>\r\n",null,null,null,null,null,null],"names":[],"mappings":"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"}