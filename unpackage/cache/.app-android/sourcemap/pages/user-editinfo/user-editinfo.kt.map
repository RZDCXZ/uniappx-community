{"version":3,"sources":["pages/user-editinfo/user-editinfo.uvue","common/socket.uts","pages/user-editinfo/user-editinfo.uvue?type=page","components/article-list-item/article-list-item.uvue","components/topic-list-item/topic-list-item.uvue"],"sourcesContent":["<template>\r\n\r\n\t<scroll-view style=\"flex:1\">\r\n\r\n\t\t<navbar title=\"编辑资料\" type=\"text\" right-text=\"完成\" @clickRight=\"sumbit\"></navbar>\r\n\t\t<view class=\"avatar-input\">\r\n\t\t\t<avatar :src=\"avatar\" width=\"175rpx\" height=\"175rpx\" @click=\"updateAvatar\"></avatar>\r\n\t\t\t<text class=\"avatar-input-tip\">点击更换头像</text>\r\n\t\t</view>\r\n\t\t<cell title=\"昵称\" :border=\"true\" :is-column=\"true\">\r\n\t\t\t<input v-model=\"name\" class=\"nickname-input\" type=\"text\" placeholder=\"请输入你的昵称\"/>\r\n\t\t</cell>\r\n\t\t<cell title=\"性别\" :border=\"true\" :right-text=\"sexText\" @click=\"openSexPicker\"></cell>\r\n\t\t<f-picker mode=\"date\" @confirm=\"confirmBirthdayPicker\">\r\n\t\t\t<cell title=\"生日\" :border=\"true\" :right-text=\"birthday == '' ? '未填写' : birthday\"></cell>\r\n\t\t</f-picker>\r\n\t\t<cell title=\"情感\" :border=\"true\" :right-text=\"qgText\" @click=\"openEmotionPicker()\"></cell>\r\n\t\t<f-city-picker @confirm=\"confirmPathPicker\">\r\n\t\t\t<cell title=\"所在地\" :border=\"true\" :right-text=\"path == '' ? '未填写' : path\"></cell>\r\n\t\t</f-city-picker>\r\n\t\t<view class=\"divider\"></view>\r\n\t\t<cell title=\"个性签名\" :show-arrow=\"false\"></cell>\r\n\t\t<textarea :value=\"desc\" placeholder=\"请输入你的个性签名\" class=\"desc-input\" @input=\"handleDescInput\"/>\r\n\t\t<view style=\"height: 300rpx;\"></view>\r\n\r\n\t</scroll-view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport { citypickerChangeEvent } from \"@/components/f-city-picker/type.uts\"\r\n\timport { defaultResult,Result,UserDetail } from \"@/common/type.uts\"\r\n\timport { getURL } from '@/common/request.uts'\r\n\timport { userState,getToken,updateUserStateAvatar,updateInfo } from \"@/store/user.uts\"\r\n\timport {\r\n\t\tsexOptions,\r\n\t\tgetSexText,\r\n\t\temotionOptions,\r\n\t\tgetEmotionText\r\n\t} from \"@/common/utils.uts\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 默认头像\r\n\t\t\t\tavatar:\"/static/default-avatar.png\",\r\n\t\t\t\tbirthday:\"\",\r\n\t\t\t\tpath:\"\",\r\n\t\t\t\tname:\"\",\r\n\t\t\t\tsex:0,\r\n\t\t\t\tqg:0,\r\n\t\t\t\tdesc:\"\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 初始化头像地址\r\n\t\t\tif(userState.avatar != null){\r\n\t\t\t\tthis.avatar = userState.avatar as string\r\n\t\t\t}\r\n\t\t\tif(userState.birthday != null){\r\n\t\t\t\tthis.birthday = userState.birthday as string\r\n\t\t\t}\r\n\t\t\tif(userState.path != null){\r\n\t\t\t\tthis.path = userState.path as string\r\n\t\t\t}\r\n\t\t\tif(userState.username != null){\r\n\t\t\t\tthis.name = userState.username as string\r\n\t\t\t}\r\n\t\t\tif(userState.desc != null){\r\n\t\t\t\tthis.desc = userState.desc as string\r\n\t\t\t}\r\n\t\t\tthis.sex = userState.sex as number\r\n\t\t\tthis.qg = userState.qg as number\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tsexText(): string {\r\n\t\t\t\treturn getSexText(this.sex)\r\n\t\t\t},\r\n\t\t\tqgText(): string {\r\n\t\t\t\treturn getEmotionText(this.qg)\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tsumbit(){\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '修改中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconst data = {\r\n\t\t\t\t\tname:this.name,\r\n\t\t\t\t\tsex:this.sex,\r\n\t\t\t\t\tqg:this.qg,\r\n\t\t\t\t\tbirthday:this.birthday,\r\n\t\t\t\t\tpath:this.path,\r\n\t\t\t\t\tdesc:this.desc\r\n\t\t\t\t} as UTSJSONObject\r\n\t\t\t\t\r\n\t\t\t\tuni.request<Result<UserDetail>>({\r\n\t\t\t\t\turl:getURL(\"/user/changeinfo\"),\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r === null) return\r\n\t\t\t\t\t\tif(res.statusCode != 200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 全局通知用户信息修改\r\n\t\t\t\t\t\tuni.$emit(\"onUpdateInfoSuccess\",\"info\")\r\n\t\t\t\t\t\t// 同步本地用户信息\r\n\t\t\t\t\t\tupdateInfo(r.data as UserDetail)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '修改成功',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\t\tdelta: 1\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail:(err)=>{\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete:()=>{\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\thandleDescInput(e:UniInputEvent){\r\n\t\t\t\tthis.desc = e.detail.value\r\n\t\t\t},\r\n\t\t\topenSexPicker(){\r\n\t\t\t\tuni.showActionSheet({\r\n\t\t\t\t\ttitle:\"请选择性别\",\r\n\t\t\t\t\titemList: sexOptions,\r\n\t\t\t\t\tsuccess:(res:ShowActionSheetSuccess)=>{\r\n\t\t\t\t\t\tthis.sex = res.tapIndex ?? 0\r\n\t\t\t\t\t\tconsole.log(this.sex);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\topenEmotionPicker(){\r\n\t\t\t\tuni.showActionSheet({\r\n\t\t\t\t\ttitle:\"请选择情感情况\",\r\n\t\t\t\t\titemList: emotionOptions,\r\n\t\t\t\t\tsuccess:(res:ShowActionSheetSuccess)=>{\r\n\t\t\t\t\t\tthis.qg = res.tapIndex ?? 0\r\n\t\t\t\t\t\tconsole.log(this.qg);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tconfirmPathPicker(e:citypickerChangeEvent){\r\n\t\t\t\tthis.path = e.label\r\n\t\t\t},\r\n\t\t\tconfirmBirthdayPicker(e:string){\r\n\t\t\t\tthis.birthday = e\r\n\t\t\t}, \r\n\t\t\tupdateAvatar(){\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount:1,\r\n\t\t\t\t\tsizeType:[\"compressed\"],\r\n\t\t\t\t\tsourceType:['album','camera'],\r\n\t\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: '上传头像中...',\r\n\t\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\turl:getURL(\"/user/changeavatar\"),\r\n\t\t\t\t\t\t\tfilePath:res.tempFilePaths[0],\r\n\t\t\t\t\t\t\tname:\"avatar\",\r\n\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\t\t\t\tlet d = JSON.parse<defaultResult>(res.data)\r\n\t\t\t\t\t\t\t\tif(d == null) return\r\n\t\t\t\t\t\t\t\tif(d.code == 0){\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: d.msg,\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconst src = d.data as string\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '修改头像成功',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// 更新本地用户信息\r\n\t\t\t\t\t\t\t\tupdateUserStateAvatar(src)\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.avatar = src\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// 通知全局修改用户信息,例如个人空间\r\n\t\t\t\t\t\t\t\tuni.$emit(\"onUpdateInfoSuccess\",\"avatar\")\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcomplete:()=>{\r\n\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n.avatar-input {\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tpadding-top: 60rpx;\r\n\tpadding-bottom: 50rpx;\r\n}\r\n.avatar-input-tip {\r\n\tfont-size: 14px;\r\n\tmargin-top: 25rpx;\r\n\tcolor: #0d0d0d;\r\n}\r\n.desc-input {\r\n\tbackground-color: #f9f9f9;\r\n\tmargin: 0 30rpx;\r\n\theight: 225rpx;\r\n\tpadding: 25rpx;\r\n\twidth: 690rpx;\r\n}\r\n.nickname-input {\r\n\theight: 90rpx;\r\n\tfont-size: 15px;\r\n\tcolor: #424242;\r\n}\r\n</style>\r\n",null,null,null,null],"names":[],"mappings":"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"}