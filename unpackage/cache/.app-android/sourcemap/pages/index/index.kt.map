{"version":3,"sources":["pages/index/index.uvue","pages/long-list/long-list-page.uvue","common/socket.uts","pages/index/index.uvue?type=page"],"sourcesContent":["<template>\r\n\t<tabs-swiper :default-tab-index=\"tabIndex\" :show-search-icon=\"true\" :tabs=\"tabs\" @loadData=\"loadData\" @change=\"onSwiperChange\">\r\n\t\t<swiper-item class=\"flex-1\" v-for=\"(item,index) in tabs\" :key=\"index\">\r\n\t\t\t<long-page ref=\"longPage\" :category_id=\"item.id\" :type=\"item.type\" :preload=\"item.preload\"></long-page>\r\n\t\t</swiper-item>\r\n\t</tabs-swiper>\r\n\t<add-post-btn/>\r\n\t<uni-upgrade-center-app ref=\"upgradePopup\" />\r\n</template>\r\n\r\n<script>\r\n\timport checkUpdate from \"@/uni_modules/uni-upgrade-center-app/utils/check-update\"\r\n\timport type { articleNav,Result,onAddArticleSuccessEvent } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport type { TabsSwiperItem } from '@/components/tabs-swiper/type.uts'\r\n\timport longPage from '@/pages/long-list/long-list-page.uvue';\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tlongPage\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttabIndex:1,\r\n\t\t\t\ttabs:[{\n\t\t\t\t\t\"id\": 0,\n\t\t\t\t\t\"name\": \"关注\",\r\n\t\t\t\t\t\"type\":\"follow\",\r\n\t\t\t\t\t\"preload\":false\n\t\t\t\t},{\n\t\t\t\t\t\"id\": 2,\n\t\t\t\t\t\"name\": \"图文\",\r\n\t\t\t\t\t\"type\":\"default\",\r\n\t\t\t\t\t\"preload\":false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": 3,\n\t\t\t\t\t\"name\": \"体育\",\r\n\t\t\t\t\t\"type\":\"default\",\r\n\t\t\t\t\t\"preload\":false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": 4,\n\t\t\t\t\t\"name\": \"热点\",\r\n\t\t\t\t\t\"type\":\"default\",\r\n\t\t\t\t\t\"preload\":false\n\t\t\t\t}] as TabsSwiperItem[],\r\n\t\t\t\t// 是否已经加载了分类\r\n\t\t\t\tisTabsLoaded:false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.loadTabs(null)\r\n\t\t\tuni.$on(\"onAddArticleSuccess\",this.onAddArticleSuccess)\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\tcheckUpdate(this.$refs[\"upgradePopup\"] as ComponentPublicInstance)\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off(\"onAddArticleSuccess\",this.onAddArticleSuccess)\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tif(!this.isTabsLoaded){\r\n\t\t\t\tthis.loadTabs(()=>{\r\n\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t(this.$refs[\"longPage\"] as ComponentPublicInstance[])[this.tabIndex].$callMethod(\"refreshData\",()=>{\r\n\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t})\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 监听发帖成功事件，刷新对应的页面\r\n\t\t\tonAddArticleSuccess(e:onAddArticleSuccessEvent){\r\n\t\t\t\t// 找到对应分类\r\n\t\t\t\tlet i = this.tabs.findIndex((o:TabsSwiperItem) : boolean => o.id == e.category_id)\r\n\t\t\t\tif(i == -1) return\r\n\t\t\t\t// 刷新对应页面\r\n\t\t\t\t(this.$refs[\"longPage\"] as ComponentPublicInstance[])[i].$callMethod(\"refreshData\",null)\r\n\t\t\t},\r\n\t\t\t// 加载分类\r\n\t\t\tloadTabs(loadComplete:(()=>void) | null){\r\n\t\t\t\tuni.request<Result<articleNav[]>>({\r\n\t\t\t\t\turl: getURL('/category/article'),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet tabs = [{\n\t\t\t\t\t\t\t\"id\": 0,\n\t\t\t\t\t\t\t\"name\": \"关注\",\r\n\t\t\t\t\t\t\t\"type\":\"follow\",\r\n\t\t\t\t\t\t\t\"preload\":false\n\t\t\t\t\t\t}] as TabsSwiperItem[]\r\n\t\t\t\t\t\tlet d = r.data as articleNav[]\r\n\t\t\t\t\t\td.forEach((o:articleNav,_:number)=>{\r\n\t\t\t\t\t\t\ttabs.push({\r\n\t\t\t\t\t\t\t\tid:o.id,\r\n\t\t\t\t\t\t\t\tname:o.title,\r\n\t\t\t\t\t\t\t\ttype:\"default\",\r\n\t\t\t\t\t\t\t\tpreload:false\r\n\t\t\t\t\t\t\t} as TabsSwiperItem)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.tabs = tabs\r\n\t\t\t\t\t\tthis.isTabsLoaded = true\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.loadData(this.tabIndex)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tif(loadComplete != null) loadComplete()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 当滑动时候，用来加载列表数据\r\n\t\t\tloadData(index:number){\r\n\t\t\t\t(this.$refs[\"longPage\"] as ComponentPublicInstance[])[index].$callMethod(\"loadData\",null)\r\n\t\t\t},\r\n\t\t\t// 当滑动时候，触发索引变化\r\n\t\t\tonSwiperChange(index:number){\r\n\t\t\t\tthis.tabIndex = index\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t\r\n</style>\n",null,null,null],"names":[],"mappings":"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"}