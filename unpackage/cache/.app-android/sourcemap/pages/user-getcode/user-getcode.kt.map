{"version":3,"sources":["pages/user-getcode/user-getcode.uvue","components/article-list-item/article-list-item.uvue","components/topic-list-item/topic-list-item.uvue","common/socket.uts","pages/user-getcode/user-getcode.uvue?type=page"],"sourcesContent":["<template>\n\t<navbar></navbar>\r\n\t<view class=\"login-page\">\r\n\t\t<text class=\"login-title\">{{ title }}</text>\r\n\t\t<view class=\"login-info\">\r\n\t\t\t<text class=\"login-info-phone\">{{ phone }}</text>\r\n\t\t\t<text class=\"iconfont\" style=\"color: #8f8f8f;\">{{ '\\ue668' }}</text>\r\n\t\t</view>\r\n\t\t<!-- 输入框 -->\r\n\t\t<login-input :auto-focus=\"true\" v-model=\"code\" placeholder=\"请输入验证码\" :maxlength=\"6\" @update:modelValue=\"submit\"></login-input>\r\n\t\t\r\n\t\t<!-- 底部 -->\r\n\t\t<view class=\"login-bottom\">\r\n\t\t\t<main-btn :disabled=\"disabled\" borderRadius=\"0\" width=\"750rpx\" height=\"98rpx\" fontSize=\"18px\" @click=\"sendSmsCode\">重新发送{{ time > 0 ? `${time}s` : '' }}</main-btn>\r\n\t\t</view>\r\n\t\t\r\n\t</view>\n</template>\n\n<script>\r\n\timport type { defaultResult,UserDetail,Result } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\n\timport { getToken, login,updatePhoneAndName } from \"@/store/user.uts\"\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tphone:\"\",\r\n\t\t\t\tcode:\"\",\r\n\t\t\t\ttime:0,\r\n\t\t\t\ttype:\"login\"\n\t\t\t}\n\t\t},\r\n\t\tonLoad(options:OnLoadOptions) {\r\n\t\t\tif(options.has(\"phone\")){\r\n\t\t\t\tthis.phone = options.get(\"phone\") as string\r\n\t\t\t}\r\n\t\t\tif(options.has(\"type\")){\r\n\t\t\t\tthis.type = options.get(\"type\") as string\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 进入页面自动获取验证码\r\n\t\tonReady() {\r\n\t\t\tif(this.phone.length == 11){\r\n\t\t\t\t// 发送短信\r\n\t\t\t\tthis.sendSmsCode()\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tdisabled(): boolean {\r\n\t\t\t\treturn this.time > 0\r\n\t\t\t},\r\n\t\t\ttitle():string{\r\n\t\t\t\tif(this.type == \"login\"){\r\n\t\t\t\t\treturn \"登录\"\r\n\t\t\t\t} else if(this.type == \"bindphone\"){\r\n\t\t\t\t\treturn \"绑定\"\r\n\t\t\t\t}\r\n\t\t\t\treturn \"\"\r\n\t\t\t}\r\n\t\t},\n\t\tmethods: {\r\n\t\t\tsubmit(code:string){\r\n\t\t\t\tif(code.length < 6) return\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: this.title + '中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tlet t = this.type == \"login\" ? 'phonelogin' : 'bindphone'\r\n\t\t\t\tuni.request<Result<UserDetail>>({\r\n\t\t\t\t\turl: getURL(`/user/${t}`),\r\n\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\tphone:this.phone,\r\n\t\t\t\t\t\tcode:code\r\n\t\t\t\t\t},\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this.type == \"login\"){\r\n\t\t\t\t\t\t\t// 处理登录\r\n\t\t\t\t\t\t\tlogin(r.data as UserDetail)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 改绑手机号\r\n\t\t\t\t\t\t\tupdatePhoneAndName(r.data as UserDetail)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\tdelta: 2\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: this.title + '成功',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsendSmsCode(){\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '发送中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tuni.request<defaultResult>({\r\n\t\t\t\t\turl: getURL('/user/sendcode'),\r\n\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\tphone:this.phone\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(r.msg == \"发送成功\"){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '发送成功'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t\t// 调试模式\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\tcontent: r.msg,\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 开启倒计时\r\n\t\t\t\t\t\tthis.handleSendSmsCode()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 开启倒计时\r\n\t\t\thandleSendSmsCode(){\r\n\t\t\t\tthis.time = 60\r\n\t\t\t\tlet interval:number = 0\r\n\t\t\t\tinterval = setInterval(()=>{\r\n\t\t\t\t\tthis.time--\r\n\t\t\t\t\tif(this.time <= 0){\r\n\t\t\t\t\t\tclearInterval(interval)\r\n\t\t\t\t\t}\r\n\t\t\t\t},1000)\r\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\r\n.login-info {\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tmargin-top: 40rpx;\r\n}\r\n.login-info-phone {\r\n\tcolor: #8f8f8f;\r\n\tfont-weight: bold;\r\n\tmargin-right: 20rpx;\r\n}\n</style>\n",null,null,null,null],"names":[],"mappings":"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"}