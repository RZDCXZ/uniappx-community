{"version":3,"sources":["pages/user-history/user-history.uvue","common/socket.uts","pages/index/index.uvue?type=page","pages/user-history/user-history.uvue?type=page"],"sourcesContent":["<template>\r\n\r\n\t<scroll-view style=\"flex:1\">\r\n\r\n\t\t<view v-if=\"!isFirstLoad && List.length == 0\" class=\"flex-1\">\r\n\t\t\t<tip />\r\n\t\t</view>\r\n\t\t<article-list-item v-for=\"(item,index) in List\" :key=\"index\" :item=\"item\"></article-list-item>\r\n\t\t<loading-more v-if=\"!isFirstLoad && List.length > 0\" :loading=\"loading\" :isEnded=\"isEnded\"></loading-more>\r\n\r\n\t</scroll-view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport { Result,ListItem,ListResult } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { getToken } from \"@/store/user.uts\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tuser_id:0,\r\n\t\t\t\tloading: false,\r\n\t\t\t\tList: [] as ListItem[],\r\n\t\t\t\tisEnded: false,\r\n\t\t\t\tcurrentPage: 1,\r\n\t\t\t\tisFirstLoad:true\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.refreshData(null)\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tthis.refreshData(()=>{\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '刷新成功',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t})\r\n\t\t},\r\n\t\tonReachBottom() {\r\n\t\t\tthis.loadData(null)\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\trefreshData(loadComplete : (() => void) | null) {\r\n\t\t\t\tthis.List.length = 0\r\n\t\t\t\tthis.currentPage = 1\r\n\t\t\t\tthis.isFirstLoad = true\r\n\t\t\t\tthis.isEnded = false\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tthis.loadData(loadComplete)\r\n\t\t\t},\r\n\t\t\tloadData(loadComplete : (() => void) | null) {\r\n\t\t\t\tif (this.loading || this.isEnded) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tuni.request<Result<ListResult>>({\r\n\t\t\t\t\turl: getURL(`/article_read_log/${Math.floor(this.currentPage)}`),\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst resData = r.data as ListResult | null\r\n\t\t\t\t\t\tif(resData == null) return\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 是否还有数据\r\n\t\t\t\t\t\tthis.isEnded = resData.last_page <= resData.current_page\r\n\t\t\t\t\t\tif(this.currentPage == 1){\r\n\t\t\t\t\t\t\tthis.List = resData.data\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.List.push(...resData.data)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 页码+1\r\n\t\t\t\t\t\tthis.currentPage = this.isEnded ? resData.current_page : Math.floor(resData.current_page + 1)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t\tthis.isFirstLoad = false\r\n\t\t\t\t\t\tif (loadComplete != null) {\r\n\t\t\t\t\t\t\tloadComplete()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n",null,null,null],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;+BAmES;;;mBAtCP,MAAS;YACR,IAAI,CAAC,WAAW,CAAC,IAAI;QACtB;;0BACA,MAAoB;YACnB,IAAI,CAAC,WAAW,CAAC,KAAI;gBACpB,+BACC,QAAO,QACP,OAAM;gBAEP;YACD;;QACD;;sBACA,MAAgB;YACf,IAAI,CAAC,QAAQ,CAAC,IAAI;QACnB;;;;;;;;;;eAzCD,mBAQc,eAAA,SARD,WAAc,eAAd,SAAA,UAAA;wBAEC,KAAA,WAAW,IAAI,KAAA,IAAI,CAAC,MAAM,IAAA,CAAA;gBAAvC,mBAEO,QAAA,qBAFuC,WAAM;oBACnD,YAAO;;;;;;YAER,mBAA8F,UAAA,IAAA,EAAA,cAAA,UAAA,CAApD,KAAA,IAAI,EAAA,IAAnB,MAAK,OAAL,GAAI,IAAA,MAAA;uBAA/B,YAA8F,8BAAA,SAA7C,SAAK,OAAQ,UAAM;;;;;wBAC/C,KAAA,WAAW,IAAI,KAAA,IAAI,CAAC,MAAM,GAAA,CAAA;gBAA/C,YAA0G,yBAAA,qBAApD,aAAS,KAAA,OAAO,EAAG,aAAS,KAAA,OAAO;;;;;;;;;aAavF;aACA;aACA;aACA;aACA;aACA;;;wBALA,aAAQ,CAAC,EACT,aAAS,KAAK,EACd,UAAM,wBACN,aAAS,KAAK,EACd,iBAAa,CAAC,EACd,iBAAY,IAAG;;;aAmBhB,cAAA,IAAY,qBAAsB,IAAI,EAAQ,EAAE;YAC/C,IAAI,CAAC,IAAI,CAAC,MAAK,GAAI,CAAA;YACnB,IAAI,CAAC,WAAU,GAAI,CAAA;YACnB,IAAI,CAAC,WAAU,GAAI,IAAG;YACtB,IAAI,CAAC,OAAM,GAAI,KAAI;YACnB,IAAI,CAAC,OAAM,GAAI,KAAI;YACnB,IAAI,CAAC,QAAQ,CAAC;QACf;;aACA,WAAA,IAAS,qBAAsB,IAAI,EAAQ,EAAE;YAC5C,IAAI,IAAI,CAAC,OAAM,IAAK,IAAI,CAAC,OAAO,EAAE;gBACjC;YACD;YACA,IAAI,CAAC,OAAM,GAAI,IAAG;YAClB,+CACC,MAAK,OAAO,AAAC,uBAAoB,KAAK,KAAK,CAAC,IAAI,CAAC,WAAW,IAC5D,SAAO;gBACN,IAAA,QAAM;aACN,EACD,UAAS,IAAC,IAAQ;gBACjB,IAAI,IAAI,IAAI,IAAG;gBACf,IAAG,KAAK,IAAI;oBAAE;;gBACd,IAAG,IAAI,UAAS,IAAI,GAAG,EAAC;oBACvB,+BACC,QAAO,EAAE,GAAG,EACZ,OAAM;oBAEP;gBACD;gBAEA,IAAM,UAAU,EAAE,IAAG,CAAE,EAAC;gBACxB,IAAG,WAAW,IAAI;oBAAE;;gBAGpB,IAAI,CAAC,OAAM,GAAI,QAAQ,SAAQ,IAAK,QAAQ,YAAW;gBACvD,IAAG,IAAI,CAAC,WAAU,IAAK,CAAC,EAAC;oBACxB,IAAI,CAAC,IAAG,GAAI,QAAQ,IAAG;gBACxB,OAAO;oBACN,IAAI,CAAC,IAAI,CAAC,IAAI,EAAI,QAAQ,IAAI;gBAC/B;gBAGA,IAAI,CAAC,WAAU,GAAI,IAAA,IAAI,CAAC,OAAM;oBAAI,QAAQ,YAAW;;oBAAI,KAAK,KAAK,CAAC,QAAQ,YAAW,GAAI,CAAC;;gBAAA;YAC7F;cACA,OAAM,IAAC,IAAQ;gBACd,+BACC,QAAO,IAAI,MAAM,EACjB,OAAM;YAER;cACA,WAAU,MAAM;gBACf,IAAI,CAAC,OAAM,GAAI,KAAI;gBACnB,IAAI,CAAC,WAAU,GAAI,KAAI;gBACvB,IAAI,gBAAgB,IAAI,EAAE;oBACzB;gBACD;YACD;;QAEF;;;sBAzDA,cAAY,qBAAsB,IAAI;sBAQtC,WAAS,qBAAsB,IAAI"}