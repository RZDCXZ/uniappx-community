{"version":3,"sources":["pages/comment-detail/comment-detail.uvue","pages/long-list/long-list-page.uvue","components/article-list-item/article-list-item.uvue","store/user.uts","common/socket.uts","pages/comment-detail/comment-detail.uvue?type=page"],"sourcesContent":["<template>\r\n\r\n\t<scroll-view :scroll-into-view=\"scrollIntoView\" :scroll-with-animation=\"true\" style=\"flex:1;background-color: #f9f9f9;\" @scrolltolower=\"onScrollBottom\">\r\n\r\n\t\t<!-- 头部 -->\r\n\t\t<view class=\"list-item-header\">\r\n\t\t\t<avatar :src=\"item.avatar\" style=\"margin-right: 27rpx;\" @click=\"openUserSpace(item.user_id)\"></avatar>\r\n\t\t\t<view @click=\"openUserSpace(item.user_id)\">\r\n\t\t\t\t<text class=\"nickname\">{{ item.name }}</text>\r\n\t\t\t\t<text class=\"time\">{{ item.create_time }}</text>\r\n\t\t\t</view>\r\n\t\t\t<follow-button type=\"button\" v-model=\"isfollow\" :user_id=\"item.user_id\"></follow-button>\r\n\t\t</view>\r\n\t\t<!-- 文字内容 -->\r\n\t\t<text class=\"content\">{{ item.content }}</text>\r\n\t\t\r\n\t\t<view class=\"divider\" id=\"divider\"></view>\r\n\r\n\t\t<comment ref=\"comment\" :isreply=\"true\" :comment_id=\"item.id\" :support_count=\"reply_count\" @reply=\"handleReply\"></comment>\r\n\r\n\r\n\t\t<view class=\"action-bar\">\r\n\t\t\t<view class=\"action-input\" @click=\"toggleCommentPopup(true)\">\r\n\t\t\t\t<text class=\"placeholder\">说点什么...</text>\r\n\t\t\t\t<text class=\"iconfont emotion\">{{ '\\ue64e' }}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 弹出评论框 -->\r\n\t\t<comment-popup ref=\"popup\"></comment-popup>\r\n\r\n\r\n\t</scroll-view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport { Result,CommentDetail,ReplyEmit,CommentItem,updateArticleChangeEvent } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { getToken,AuthAction } from \"@/store/user\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tisfollow:false,\r\n\t\t\t\treply_count:0,\r\n\t\t\t\tscrollIntoView:\"\",\r\n\t\t\t\t\r\n\t\t\t\titem:{\r\n\t\t\t\t\t\"id\": 1766,\r\n\t\t\t\t\t\"article_id\": 1034,\r\n\t\t\t\t\t\"user_id\": 1108,\r\n\t\t\t\t\t\"reply_count\": 0,\r\n\t\t\t\t\t\"content\": \"阿里健康\",\r\n\t\t\t\t\t\"comment_id\": null,\r\n\t\t\t\t\t\"create_time\": \"2021-04-15 17:40:53\",\r\n\t\t\t\t\t\"avatar\": null,\r\n\t\t\t\t\t\"name\": \"13163224966\",\r\n\t\t\t\t\t\"isfollow\": false\r\n\t\t\t\t} as CommentDetail\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options:OnLoadOptions) {\r\n\t\t\tif(options.has(\"id\")){\r\n\t\t\t\tthis.item.id = parseInt(options.get(\"id\") as string)\r\n\t\t\t\t// 加载评论详情\r\n\t\t\t\tthis.loadCommentDetail()\r\n\t\t\t}\r\n\t\t\tuni.$on(\"onSendCommentSuccess\",this.onSendCommentSuccess)\r\n\t\t\t// 监听帖子变化\r\n\t\t\tuni.$on(\"onUpdateArticleChange\",this.onUpdateArticleChange)\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off(\"onSendCommentSuccess\",this.onSendCommentSuccess)\r\n\t\t\tuni.$off(\"onUpdateArticleChange\",this.onUpdateArticleChange)\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 监听帖子变化\r\n\t\t\tonUpdateArticleChange(e:updateArticleChangeEvent){\r\n\t\t\t\tif(e.key == \"updateFollow\" && this.item.user_id == e.id){\r\n\t\t\t\t\tthis.isfollow = e.value == \"true\" ? true : false \r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 评论/回复成功回调\r\n\t\t\tonSendCommentSuccess(e:CommentItem){\r\n\t\t\t\t// 如果是评论，直接终止\r\n\t\t\t\tif(e.comment_id == null) return\r\n\t\t\t\t// 回复数+1\r\n\t\t\t\tthis.reply_count = Math.floor(this.reply_count + 1)\r\n\t\t\t\t// 滚动到评论位置\r\n\t\t\t\tthis.scrollIntoView = \"\"\r\n\t\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\t\tthis.scrollIntoView = \"divider\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 显示隐藏评论框\r\n\t\t\ttoggleCommentPopup(show:boolean){\r\n\t\t\t\tAuthAction(()=>{\r\n\t\t\t\t\tlet popup = this.$refs[\"popup\"] as ComponentPublicInstance\r\n\t\t\t\t\tpopup.$callMethod(\"toggleCommentPopup\",show,null,this.item.id)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 打开回复框\r\n\t\t\thandleReply(e:ReplyEmit){\r\n\t\t\t\tAuthAction(()=>{\r\n\t\t\t\t\tlet popup = this.$refs[\"popup\"] as ComponentPublicInstance\r\n\t\t\t\t\tpopup.$callMethod(\"toggleCommentPopup\",true,e.placeholder,e.reply_id)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 触底事件\r\n\t\t\tonScrollBottom(){\r\n\t\t\t\t// 加载更多评论\r\n\t\t\t\t(this.$refs[\"comment\"] as ComponentPublicInstance).$callMethod(\"loadCommentList\")\r\n\t\t\t},\r\n\t\t\t// 打开个人空间页\r\n\t\t\topenUserSpace(user_id:number){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/user-space/user-space?user_id='+user_id,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 加载评论详情\r\n\t\t\tloadCommentDetail(){\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '加载中...',\r\n\t\t\t\t\tmask: false\r\n\t\t\t\t});\r\n\t\t\t\tuni.request<Result<CommentDetail>>({\r\n\t\t\t\t\turl: getURL(`/comment/${this.item.id}`),\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\t\tthis.item = r.data as CommentDetail\r\n\t\t\t\t\t\tthis.isfollow = this.item.isfollow\r\n\t\t\t\t\t\tthis.reply_count = this.item.reply_count\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n/* 头部 */\r\n.list-item-header {\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tpadding-top: 26rpx;\r\n\tpadding-left: 33rpx;\r\n\tpadding-right: 33rpx;\r\n\tbackground-color: #ffffff;\r\n}\r\n\r\n.time {\r\n\tfont-size: 13px;\r\n\tcolor: #a7a7a7;\r\n\tmargin-top: 10rpx;\r\n}\r\n.nickname {\r\n\tcolor: #050505;\r\n\ttext-overflow: ellipsis;\r\n\tmax-width: 240rpx;\r\n\theight: 34rpx;\r\n\tfont-size: 15px;\r\n\tfont-weight: bold;\r\n}\r\n.content {\r\n\tpadding-top: 25rpx;\r\n\tpadding-left: 33rpx;\r\n\tpadding-right: 33rpx;\r\n\tfont-size: 16px;\r\n\tline-height: 1.5;\r\n\tpadding-bottom: 20rpx;\r\n\tbackground-color: #ffffff;\r\n}\r\n.content-image {\r\n\twidth: 750rpx;\r\n\tbackground-color: #f0f0f0;\r\n}\r\n.action-bar {\r\n\tbackground-color: #ffffff;\r\n\tposition: fixed;\r\n\tbottom: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tborder-top: 1rpx solid #f2f2f2;\r\n\tz-index: 100;\r\n\theight: 103rpx;\r\n\tpadding-left: 28rpx;\r\n\tpadding-right: 28rpx;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n}\r\n.action-input {\r\n\tflex-direction: row;\r\n\tbackground-color: #f4f4f4;\r\n\theight: 73rpx;\r\n\t/* width: 250rpx; */\r\n\tflex: 1;\r\n\tborder-radius: 5px;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n\tpadding: 0 20rpx;\r\n}\r\n.placeholder {\r\n\tfont-size: 14px;\r\n\tcolor: #949494;\r\n}\r\n.emotion {\r\n\tfont-size: 20px;\r\n\tcolor: #191919;\r\n}\r\n</style>",null,null,null,null,null],"names":[],"mappings":"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"}