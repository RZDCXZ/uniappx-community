{"version":3,"sources":["pages/user-reset-password/user-reset-password.uvue","components/article-list-item/article-list-item.uvue","components/topic-list-item/topic-list-item.uvue","common/socket.uts","pages/user-reset-password/user-reset-password.uvue?type=page"],"sourcesContent":["<template>\n\t<navbar></navbar>\r\n\t<view class=\"login-page\">\r\n\t\t<text class=\"login-title\">{{ title }}</text>\r\n\t\t<text class=\"input-tip\" v-if=\"phone != '' \">通过手机号 {{ phone }} 进行验证</text>\r\n\t\t<login-input style=\"margin-top: 10rpx;\" v-model=\"code\" placeholder=\"请输入验证码\" :maxlength=\"6\" :btn=\"time > 0 ? `${time}s` : '发送验证码'\" @click=\"sendSmsCode\"></login-input>\r\n\t\t<login-input :password=\"true\" type=\"safe-password\" style=\"margin-top: 0;\" v-model=\"password\" placeholder=\"请输入密码\" confirm-type=\"send\" @confirm=\"submit\"></login-input>\r\n\t\t<text class=\"input-tip\">温馨提示：密码为6-20位，至少包含大写/小写字母/数字符号2中组合</text>\r\n\t\t<!-- 底部 -->\r\n\t\t<view class=\"login-bottom\">\r\n\t\t\t<main-btn :disabled=\"disabled\" borderRadius=\"0\" width=\"750rpx\" height=\"98rpx\" fontSize=\"18px\" @click=\"submit()\">完成</main-btn>\r\n\t\t</view>\r\n\t</view>\n</template>\n\n<script>\r\n\timport type { defaultResult,UserDetail,Result } from \"@/common/type.uts\"\r\n\timport { getURL } from \"@/common/request.uts\"\r\n\timport { getToken, userState,updatePassword } from '@/store/user.uts'\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcode:\"\",\r\n\t\t\t\tpassword:\"\",\r\n\t\t\t\ttime:0,\r\n\t\t\t\ttype:\"changepwd\",\r\n\t\t\t\tphone:\"\"\n\t\t\t}\n\t\t},\r\n\t\tonLoad(options:OnLoadOptions) {\r\n\t\t\tif(options.has(\"phone\")){\r\n\t\t\t\tthis.phone = options.get(\"phone\") as string\r\n\t\t\t} else {\r\n\t\t\t\tthis.phone = userState.phone as string\r\n\t\t\t}\r\n\t\t\tif(options.has(\"type\")){\r\n\t\t\t\tthis.type = options.get(\"type\") as string\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\ttitle():string{\r\n\t\t\t\tif(this.type == \"forget\"){\r\n\t\t\t\t\treturn \"重置密码\"\r\n\t\t\t\t}\r\n\t\t\t\treturn \"修改密码\"\r\n\t\t\t},\r\n\t\t\tdisabled(): boolean {\r\n\t\t\t\treturn this.password.trim().length < 5\r\n\t\t\t},\r\n\t\t\tsendSmsDisabled(): boolean {\r\n\t\t\t\treturn this.time > 0\r\n\t\t\t},\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t// 发送验证码\n\t\t\tsendSmsCode(){\r\n\t\t\t\tif(this.sendSmsDisabled) return\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '发送中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tlet data = {} as UTSJSONObject\r\n\t\t\t\tlet url = \"sendcode2\"\r\n\t\t\t\tif(this.type == \"forget\"){\r\n\t\t\t\t\tdata.set(\"phone\",this.phone)\r\n\t\t\t\t\turl = \"sendcode\"\r\n\t\t\t\t}\r\n\t\t\t\tuni.request<defaultResult>({\r\n\t\t\t\t\turl: getURL(`/user/${url}`),\r\n\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(r.msg == \"发送成功\"){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '发送成功'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t\t// 调试模式\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\tcontent: r.msg,\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 开启倒计时\r\n\t\t\t\t\t\tthis.handleSendSmsCode()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 开启倒计时\r\n\t\t\thandleSendSmsCode(){\r\n\t\t\t\tthis.time = 60\r\n\t\t\t\tlet interval:number = 0\r\n\t\t\t\tinterval = setInterval(()=>{\r\n\t\t\t\t\tthis.time--\r\n\t\t\t\t\tif(this.time <= 0){\r\n\t\t\t\t\t\tclearInterval(interval)\r\n\t\t\t\t\t}\r\n\t\t\t\t},1000)\r\n\t\t\t},\r\n\t\t\t// 提交\r\n\t\t\tsubmit(){\r\n\t\t\t\tif(this.disabled) return\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '修改中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\tcode:this.code,\r\n\t\t\t\t\tpassword:this.password\r\n\t\t\t\t} as UTSJSONObject\r\n\t\t\t\t\r\n\t\t\t\tif(this.type == \"forget\"){\r\n\t\t\t\t\tdata.set(\"phone\",this.phone)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.request<defaultResult>({\r\n\t\t\t\t\turl: getURL(`/user/${this.type}`),\r\n\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\theader:{\r\n\t\t\t\t\t\ttoken:getToken()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tlet r = res.data\r\n\t\t\t\t\t\tif(r == null) return\r\n\t\t\t\t\t\tif(res.statusCode !=200){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet delta = 1\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this.type == \"changepwd\"){\r\n\t\t\t\t\t\t\t// 更新本地密码状态\r\n\t\t\t\t\t\t\tupdatePassword()\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdelta = 2\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: r.msg,\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\t\tdelta\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},300)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>\n",null,null,null,null],"names":[],"mappings":"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"}